import{S as g,_ as C,o as r,c as a,b as o,t as f,d as h,i as k,h as m,f as V,z as L,p as B,e as w,a6 as v,W as b,Z as A,C as S,T as E,k as _,l as D,R as F,a3 as T,r as P,ak as R,w as x,j as N,B as z}from"./index-iNDi3pII.js";import{_ as M}from"./OTPInputs-CivkqC3x.js";import{A as U}from"./left-arrow-back-Ij0_QEXL.js";const W={components:{OTPInputs:M,BaseLoader:g},props:{phone:String,unmaskedValue:String,recovery:Boolean},emits:["handleChangeScreen","resendCode","setOtpValue"],data(){return{timer:60,intervalId:null,canResend:!1,errorMsg:"",loading:!1}},watch:{errorMsg(){this.errorMsg&&setTimeout(()=>{this.errorMsg=""},4e3)}},methods:{async handleOtp(e){this.verifyCode(e).then(s=>{s?(this.$emit("setOtpValue",e),this.$emit("handleChangeScreen",{nextStep:"create",isRecovery:this.recovery})):this.errorMsg="Неправильный код"}).catch(s=>{console.error("Ошибка при проверке кода:",s)})},async verifyCode(e){this.loading=!0;try{return!!(await this.$axiosApi.post("gazprom-app/auth/check-otp",{contactNumber:this.unmaskedValue,code:Number(e)})).data.result}catch(s){return console.log(s),!1}finally{this.loading=!1}},startTimer(){this.timer=60,this.canResend=!1,this.intervalId=setInterval(()=>{this.timer>0?this.timer--:(this.canResend=!0,clearInterval(this.intervalId),this.errorMsg="")},1e3)},resendCode(){this.$emit("resendCode"),this.startTimer()}},mounted(){this.startTimer()}},q=e=>(B("data-v-921a6da4"),e=e(),w(),e),H={class:"otp"},j=q(()=>o("span",{class:"title"},"Введите код из SMS",-1)),Z={class:"subtitle"},G={key:1,class:"error-msg"},J={key:2,class:"timer"},K=["disabled"];function Q(e,s,l,y,u,t){const d=M,p=g;return r(),a("div",H,[j,o("span",Z,"Отправили на "+f(l.phone),1),h(d,{error:!!u.errorMsg,numDigits:5,onComplete:t.handleOtp},null,8,["error","onComplete"]),u.loading?(r(),k(p,{key:0,loaderWidth:"10px",color:"#1852E0"})):m("",!0),u.errorMsg?(r(),a("span",G,f(u.errorMsg),1)):m("",!0),u.timer!==0?(r(),a("span",J,"Повторная отправка кода через: "+f(u.timer)+" сек.",1)):m("",!0),V(),o("button",{onClick:s[0]||(s[0]=(...c)=>t.resendCode&&t.resendCode(...c)),class:L(u.canResend?"btn":"btn-disabled"),disabled:!u.canResend},"Получить код еще раз",10,K)])}const X=C(W,[["render",Q],["__scopeId","data-v-921a6da4"]]),Y={components:{BaseAuthInput:v},props:{msg:String,loadingPhone:Boolean},data(){return{phone:"+996 ",errorMsg:"",unmaskedValue:""}},emits:["handleChangeScreen","changePhoneValue","sendSMS"],created(){setTimeout(()=>{this.$refs.phoneInput.$refs.input.focus()},400)},watch:{msg(){this.msg&&(this.errorMsg=this.msg)}},directives:{maska:b},methods:{sendSMS(){if(this.unmaskedValue.length!==9){this.errorMsg="Некорректный номер";return}this.$emit("changePhoneValue",{phone:this.phone,unmaskedValue:this.unmaskedValue}),this.$emit("sendSMS")}}},$=e=>(B("data-v-dc1be44a"),e=e(),w(),e),ee=$(()=>o("span",{class:"main-text"},"Регистрация",-1)),se=$(()=>o("p",null,"Мы отправим на номер SMS-сообщение с кодом подтверждения",-1)),ue={key:0,class:"error-msg"},oe={class:"button",type:"submit"},te={key:1};function re(e,s,l,y,u,t){const d=v,p=g,c=A("maska");return r(),a("form",{class:"form",method:"post",onSubmit:s[1]||(s[1]=E((...n)=>t.sendSMS&&t.sendSMS(...n),["prevent"]))},[ee,se,S(h(d,{ref:"phoneInput",error:!!u.errorMsg,appendIcon:"@/assets/images/phone.svg",modelValue:u.phone,"onUpdate:modelValue":s[0]||(s[0]=n=>u.phone=n),placeholder:"Введите телефон",label:"Телефон"},null,8,["error","modelValue"]),[[c,"+996 (###)-###-###","unmaskedValue",{unmasked:!0}]]),u.errorMsg?(r(),a("span",ue,f(u.errorMsg),1)):m("",!0),o("button",oe,[l.loadingPhone?(r(),k(p,{key:0,loaderWidth:"10px",color:"white"})):(r(),a("span",te,"Получить код"))])],32)}const ne=C(Y,[["render",re],["__scopeId","data-v-dc1be44a"]]),ae={components:{OTPInputs:M,Arrow:U,BaseLoader:g},props:{unmaskedValue:String,otpCode:String,phone:{type:String,required:!0},msg:{type:String,required:!1},recovery:Boolean},emits:["handleChangeScreen","changePhoneValue","sendSMS","resendCode","setOtpValue"],data(){return{step:"password",passwordRetype:"",password:"",errorMsg:"",isLoading:!1,rules:{checkBoxService:!1,checkBoxPrivacy:!1}}},methods:{..._(D,["close"]),..._(F,["storeLoggedInUser"]),..._(T,["removeChatCookie"]),async registerUser(){if(this.password.length<4||this.passwordRetype.length<4){this.errorMsg="Пароль должен быть длинне 4 цифр";return}if(this.password!==this.passwordRetype){this.errorMsg="Пароли не совпадают";return}this.isLoading=!0;const e=this.recovery?"gazprom-app/auth/passcode":"gazprom-app/auth/create",s={contactNumber:this.unmaskedValue,passCode:this.password,otpCode:this.otpCode};await this.$axiosApi[this.recovery?"put":"post"](e,s).then(({data:l})=>{l&&(this.storeLoggedInUser(l.accessToken),this.$router.push("/profile"),this.removeChatCookie(),this.close())}).catch(l=>{console.error("Ошибка:",l),this.errorMsg="Ошибка выполнения запроса"}),this.isLoading=!1},updatePassword(e){this.password=e},updatePasswordRetype(e){this.passwordRetype=e},handlePassword(){if(!this.password){this.errorMsg="Заполните поле";return}if(this.password.length<4){this.errorMsg="Пароль должен быть длинне 4 цифр";return}this.step="passwordRetype",this.errorMsg=""}}},I=e=>(B("data-v-a9be7d8a"),e=e(),w(),e),ie={key:0,class:"wrap"},le=I(()=>o("span",{class:"main-text"},"Придумайте пароль",-1)),de=I(()=>o("p",null,"Создайте пароль для последующего входа в личный кабинет",-1)),pe={class:"error-msg"},ce={class:"input-wrap"},he={key:1,class:"wrap"},me=I(()=>o("span",{class:"main-text"},"Повторите пароль",-1)),ge=I(()=>o("p",null,"Пожалуйста, повторите введенный ранее пароль",-1)),_e={class:"error-msg"},fe={class:"input-wrap"},ke={style:{"margin-bottom":"20px"}},Ce={class:"checkbox"},ve={class:"checkbox"},ye=["disabled"],Se={key:1};function Be(e,s,l,y,u,t){const d=P("Arrow"),p=M,c=P("router-link"),n=g;return r(),a("div",null,[u.step==="passwordRetype"?(r(),k(d,{key:0,onClick:s[0]||(s[0]=i=>u.step="password"),class:"arrow-back"})):m("",!0),o("form",{method:"post",onSubmit:s[7]||(s[7]=E((...i)=>t.registerUser&&t.registerUser(...i),["prevent"]))},[u.step==="password"?(r(),a("div",ie,[le,de,o("span",pe,f(u.errorMsg),1),o("div",ce,[h(p,{error:!!u.errorMsg,modelValue:u.password,"onUpdate:modelValue":s[1]||(s[1]=i=>u.password=i),onComplete:t.updatePassword,"digit-count":4},null,8,["error","modelValue","onComplete","digit-count"])]),o("button",{class:"button btn-next",type:"button",onClick:s[2]||(s[2]=(...i)=>t.handlePassword&&t.handlePassword(...i))},"Далее")])):m("",!0),u.step==="passwordRetype"?(r(),a("div",he,[me,ge,o("span",_e,f(u.errorMsg),1),o("div",fe,[h(p,{error:!!u.errorMsg,modelValue:u.passwordRetype,"onUpdate:modelValue":s[3]||(s[3]=i=>u.passwordRetype=i),onComplete:t.updatePasswordRetype,"digit-count":4},null,8,["error","modelValue","onComplete","digit-count"])]),o("div",ke,[o("label",Ce,[S(o("input",{type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=i=>u.rules.checkBoxService=i)},null,512),[[R,u.rules.checkBoxService]]),h(c,{class:"label-link",to:"/public-oferta",target:"_blank"},{default:x(()=>[V("Условия сервиса")]),_:1})]),o("label",ve,[S(o("input",{type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=i=>u.rules.checkBoxPrivacy=i)},null,512),[[R,u.rules.checkBoxPrivacy]]),h(c,{class:"label-link",to:"/about/company-policy",target:"_blank"},{default:x(()=>[V("Политика конфиденциальности")]),_:1})])]),o("button",{disabled:!u.rules.checkBoxService||!u.rules.checkBoxPrivacy,class:L(["button",{disabled:!u.rules.checkBoxService||!u.rules.checkBoxPrivacy}]),type:"button",onClick:s[6]||(s[6]=(...i)=>t.registerUser&&t.registerUser(...i))},[u.isLoading?(r(),k(n,{key:0,loaderWidth:"10px",color:"white"})):(r(),a("span",Se,"Создать"))],10,ye)])):m("",!0)],32)])}const we=C(ae,[["render",Be],["__scopeId","data-v-a9be7d8a"]]),Ve=N({components:{BaseAuthInput:v,BaseLoader:g},directives:{maska:b},data(){return{phone:"+996 ",unmaskedValue:"",errorMsg:"",password:"",loading:!1}},created(){setTimeout(()=>{this.$refs.phoneInput.$refs.input.focus()},400)},methods:{..._(D,["close"]),..._(F,["fetchUserProfile"]),..._(F,["storeLoggedInUser"]),..._(T,["removeChatCookie"]),async authLogin(){if(!this.unmaskedValue||!this.password){this.errorMsg="Заполните все поля";return}this.loading=!0;try{await this.$axiosApi.post("gazprom-app/auth/login",{contactNumber:"996"+this.unmaskedValue,passCode:this.password,hasBiometric:!1}).then(({data:e})=>{e&&(this.storeLoggedInUser(e.accessToken),this.$router.push("/profile"),this.removeChatCookie(),this.close())}).catch(e=>{e.response&&e.response.data&&e.response.data.message?this.errorMsg=e.response.data.message:this.errorMsg="Неверный логин или пароль"})}catch(e){console.log(e)}this.loading=!1}}}),be=e=>(B("data-v-eff33331"),e=e(),w(),e),Ee=be(()=>o("span",{class:"main-text"},"Вход в личный кабинет",-1)),Me={class:"error-msg"},Ie={class:"button",type:"submit"},Fe={key:1},Pe={class:"no-accaunt"};function Ae(e,s,l,y,u,t){const d=v,p=g,c=A("maska");return r(),a("form",{method:"post",onSubmit:s[4]||(s[4]=E((...n)=>e.authLogin&&e.authLogin(...n),["prevent"]))},[Ee,o("span",Me,f(e.errorMsg),1),S(h(d,{ref:"phoneInput",error:!!e.errorMsg,appendIcon:"@/assets/images/phone.svg",modelValue:e.phone,"onUpdate:modelValue":s[0]||(s[0]=n=>e.phone=n),placeholder:"Введите телефон",label:"Телефон"},null,8,["error","modelValue"]),[[c,"+996 (###)-###-###","unmaskedValue",{unmasked:!0}]]),h(d,{error:!!e.errorMsg,appendIcon:"@/assets/images/password.svg",inputType:"password",modelValue:e.password,"onUpdate:modelValue":s[1]||(s[1]=n=>e.password=n),placeholder:"Пароль",label:"Пароль"},null,8,["error","modelValue"]),o("span",{class:"forgot-password",onClick:s[2]||(s[2]=n=>e.$emit("handleChangeScreen",{nextStep:"recovery",isRecovery:!0}))},"Забыли пароль?"),o("button",Ie,[e.loading?(r(),k(p,{key:0,loaderWidth:"10px",color:"white"})):(r(),a("span",Fe,"Войти"))]),o("span",Pe,[V("Нет аккаунта? "),o("b",{onClick:s[3]||(s[3]=n=>e.$emit("handleChangeScreen",{nextStep:"sendSMS",isRecovery:!1}))},"Зарегистрироваться")])],32)}const De=C(Ve,[["render",Ae],["__scopeId","data-v-eff33331"]]),Re={name:"RecoveryForm",components:{BaseAuthInput:v,BaseLoader:g},data(){return{phone:"+996 ",msg:"",unmaskedValue:"",isLoading:!1}},created(){setTimeout(()=>{this.$refs.phoneInput.$refs.input.focus()},400)},directives:{maska:b},methods:{async sendPhone(){if(this.unmaskedValue.length!==9){this.msg="Некорректный номер";return}this.$emit("handleChangeScreen",{nextStep:"otp",isRecovery:!0}),this.$emit("changePhoneValue",{phone:this.phone,unmaskedValue:this.unmaskedValue}),this.isLoading=!0;try{await this.$axiosApi.post("gazprom-app/auth/recovery",{contactNumber:"996"+this.unmaskedValue,platform:"Andriod"}).then(({data:e})=>{e&&(this.$emit("handleChangeScreen","otp",!0),this.$emit("changePhoneValue",{phone:this.phone,unmaskedValue:this.unmaskedValue}),this.msg="")})}catch(e){console.log(e),this.msg="Некорректный номер"}this.isLoading=!1}}},O=e=>(B("data-v-5955d7d9"),e=e(),w(),e),xe=O(()=>o("span",{class:"main-text"},"Восстановление пароля",-1)),Le=O(()=>o("p",null,"Мы отправим на номер SMS-сообщение с кодом подтверждения",-1)),Te={key:0,class:"error-msg"},Ue={class:"button",type:"submit"},$e={key:1};function Oe(e,s,l,y,u,t){const d=v,p=g,c=A("maska");return r(),a("form",{method:"post",onSubmit:s[1]||(s[1]=E((...n)=>t.sendPhone&&t.sendPhone(...n),["prevent"]))},[xe,Le,S(h(d,{ref:"phoneInput",error:!!u.msg,appendIcon:"@/assets/images/phone.svg",modelValue:u.phone,"onUpdate:modelValue":s[0]||(s[0]=n=>u.phone=n),placeholder:"Введите телефон",label:"Телефон"},null,8,["error","modelValue"]),[[c,"+996 (###)-###-###","unmaskedValue",{unmasked:!0}]]),u.msg?(r(),a("span",Te,f(u.msg),1)):m("",!0),o("button",Ue,[u.isLoading?(r(),k(p,{key:0,loaderWidth:"10px",color:"white"})):(r(),a("span",$e,"Получить код"))])],32)}const Ne=C(Re,[["render",Oe],["__scopeId","data-v-5955d7d9"]]),ze={components:{OTP:X,SendSMS:ne,LoginForm:De,RegisterForm:we,RecoveryForm:Ne,Arrow:U},directives:{maska:b},data(){return{phone:"+996 ",step:"login",otp:"",unmaskedValue:"",errorMsg:"",isRecovery:!1,smsLoading:!1}},computed:{currentComponent(){return{login:"LoginForm",sendSMS:"SendSMS",otp:"OTP",create:"RegisterForm",recovery:"RecoveryForm"}[this.step]},formattedPhone(){return"996"+this.unmaskedValue},isBackVisible(){return this.step==="otp"||this.step==="sendSMS"}},methods:{..._(D,["close"]),handleBackClick(){this.step==="otp"&&!this.isRecovery?this.step="sendSMS":this.step==="otp"&&this.isRecovery?this.step="recovery":this.step="login"},async sendPhone(){this.smsLoading=!0;try{const{data:e}=await this.$axiosApi.post("gazprom-app/auth/send-sms",{contactNumber:this.formattedPhone,platform:"Andriod",checkUser:!0});e&&(this.step="otp",this.errorMsg="")}catch(e){console.error(e),this.errorMsg=e.response.data.message}this.smsLoading=!1},handleResendCode(){this.sendPhone()},handleChangeScreen({nextStep:e,isRecovery:s}){this.step=e,s===!0&&(this.isRecovery=!0)},setOtpValue(e){this.otp=e},setTelValue({phone:e,unmaskedValue:s}){this.phone=e,this.unmaskedValue=s}}},We={class:"wrap"};function qe(e,s,l,y,u,t){const d=P("Arrow");return r(),a("div",We,[t.isBackVisible?(r(),k(d,{key:0,onClick:t.handleBackClick,class:"arrow-back"},null,8,["onClick"])):m("",!0),(r(),k(z(t.currentComponent),{onHandleChangeScreen:t.handleChangeScreen,onChangePhoneValue:t.setTelValue,onSendSMS:t.sendPhone,onResendCode:t.handleResendCode,onSetOtpValue:t.setOtpValue,phone:u.phone,unmaskedValue:t.formattedPhone,otpCode:u.otp,msg:u.errorMsg,recovery:u.isRecovery,loadingPhone:u.smsLoading},null,40,["onHandleChangeScreen","onChangePhoneValue","onSendSMS","onResendCode","onSetOtpValue","phone","unmaskedValue","otpCode","msg","recovery","loadingPhone"]))])}const Ge=C(ze,[["render",qe],["__scopeId","data-v-3769b28e"]]);export{Ge as default};
