import{x as f,c6 as C,k as _,l as D,R as y,_ as k,r as x,o as t,c as r,t as a,h as i,b as o,f as m,d as l,F as B,g as E,w as I,i as b,S as w,T as A}from"./index-D7bkaMlJ.js";const F={name:"EditAccountsOrderModal",components:{BaseButton:f,DeleteIcon:C},props:{accounts:{type:Array,required:!0}},data(){return{reorderedAccounts:[...this.accounts],draggedItemIndex:null,selectedAccount:null,error:"",loading:!1}},computed:{hasAvailableAccounts(){return this.reorderedAccounts.some(e=>e.account)}},methods:{..._(D,["close"]),..._(y,["fetchUserProfile"]),onDragStart(e){this.draggedItemIndex=e},onDragOver(e){},onDrop(e){if(this.draggedItemIndex!==null){const u=this.reorderedAccounts[this.draggedItemIndex];this.reorderedAccounts.splice(this.draggedItemIndex,1),this.reorderedAccounts.splice(e,0,u),this.draggedItemIndex=null}},async removeAccount(){try{this.loading=!0;const{data:e}=await this.$axiosApi.delete(`gazprom-app/user/facility/${this.selectedAccount}`);e&&(await this.fetchUserProfile(this.$axiosApi),this.close())}catch(e){console.error("Ошибка при отвязке лицевого счета:",e),this.error="Произошла ошибка при отвязке лицевого счета"}this.loading=!1},async applyChanges(){this.loading=!0;const e=this.reorderedAccounts.map(u=>u.account);try{await this.$axiosApi.post("gazprom-app/user/facility/updateOrder",{facilities:e}).then(({data:u})=>{u&&(this.fetchUserProfile(this.$axiosApi),this.close())})}catch(u){console.error("Ошибка при обновлении порядка счетов:",u),this.error="Произошла ошибка при обновлении порядка счетов"}this.loading=!1}}},S={class:"edit-accounts"},O=o("div",{class:"title"},"Настройка лицевых счетов",-1),M={key:0},N={key:1},U={key:2,class:"error-msg"},V={key:3,class:"delete-acc-modal"},P={key:0},z={key:1,style:{"margin-top":"10px"}},L=["onDragstart","onDragover","onDrop"],T={class:"edit-info"},q={key:0,class:"edit-acc"},R={class:"edit-address"},W={class:"btns"};function j(e,u,G,H,s,c){const p=w,v=x("DeleteIcon"),g=f;return t(),r("div",S,[O,c.hasAvailableAccounts?(t(),r("p",N,"Перетащите лицевой счет, чтобы изменить порядок его отображения")):(t(),r("p",M,"Нет доступных лицевых счетов.")),s.error?(t(),r("span",U,a(s.error),1)):i("",!0),s.selectedAccount?(t(),r("div",V,[o("span",null,[m("Вы ходите удалить лицевой счет "),o("b",null,a(s.selectedAccount),1),m("?")]),s.loading?(t(),r("div",z,[l(p)])):(t(),r("div",P,[o("button",{class:"operation",onClick:u[0]||(u[0]=(...n)=>c.removeAccount&&c.removeAccount(...n))},"Удалить"),o("button",{class:"operation cancel",onClick:u[1]||(u[1]=n=>s.selectedAccount=null)},"Отмена")]))])):i("",!0),o("ul",null,[(t(!0),r(B,null,E(s.reorderedAccounts.filter(n=>n.account),(n,d)=>(t(),r("li",{key:n.id,draggable:"true",onDragstart:h=>c.onDragStart(d),onDragover:A(h=>c.onDragOver(d),["prevent"]),onDrop:h=>c.onDrop(d)},[o("div",T,[o("div",null,[n.account?(t(),r("span",q,"ЛС: "+a(n.account),1)):i("",!0),o("span",R,a(n.address),1)]),o("div",null,[l(v,{fill:"#FC4E3C",width:"24",height:"24",class:"delete-icon",onClick:A(h=>s.selectedAccount=n.account,["prevent"])},null,8,["onClick"])])])],40,L))),128))]),o("div",W,[l(g,{onClick:e.close,text:"Отмена",withoutIcon:!0,bgColor:"transparent",textColor:"#1852E0",style:{"align-self":"center !important"},class:"cancel-btn"},null,8,["onClick"]),l(g,{onClick:c.applyChanges,"disabled-btn":!c.hasAvailableAccounts,text:s.loading?"":"Применить",withoutIcon:!0,bgColor:"#1852E0",style:{"margin-top":"30px !important","align-self":"stretch"}},{btnContent:I(()=>[s.loading?(t(),b(p,{key:0,loaderWidth:"10px",color:"white"})):i("",!0)]),_:1},8,["onClick","disabled-btn","text"])])])}const K=k(F,[["render",j]]);export{K as default};
