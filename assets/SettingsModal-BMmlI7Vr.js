import{S as B,W as b,m as F,R as g,k as C,l as S,_ as N,r as x,Z as I,o,c as r,i as E,h as n,b as a,F as D,g as k,t as d,C as _,d as c,w as V,T as A,x as X,p as U,e as M,y as T}from"./index-B6tr8DrX.js";import{_ as L}from"./BaseInput-JN1cGErG.js";import{A as j}from"./left-arrow-back-jjdbgrUe.js";const z={components:{BaseLoader:B,Arrow:j},name:"SettingsModal",directives:{maska:b},data(){return{step:"settings",activeSessions:[],passwordData:{curPassCode:"",newPassCode:"",reNewPassCode:""},passwordError:{curPassCode:"",newPassCode:"",reNewPassCode:""},globalError:"",loading:!1}},computed:{...F(g,["userProfile"])},methods:{...C(S,["close"]),...C(g,["fetchUserProfile"]),handleStep(){this.step="sessions",this.fetchSessions()},handleBackClick(){(this.step==="sessions"||this.step==="changePin"||this.step==="changeFullname")&&(this.step="settings")},validateField(s,u){this.passwordError[s]="",u?(u.length!==4||/\D/.test(u))&&(this.passwordError[s]="Пароль должен состоять из 4 цифр."):this.passwordError[s]="Поле не может быть пустым.",s==="reNewPassCode"&&u&&u!==this.passwordData.newPassCode&&(this.passwordError.reNewPassCode="Пароли не совпадают.")},async changePassword(){if(this.globalError="",Object.keys(this.passwordData).forEach(s=>{this.validateField(s,this.passwordData[s])}),!Object.values(this.passwordError).some(s=>s)){this.loading=!0;try{await this.$axiosApi.post("/gazprom-app/user/changePass",this.passwordData).then(({data:s})=>{s&&this.close()}).catch(s=>{this.globalError=s.response.data.message||{}})}catch(s){s.response&&s.response.data&&(this.globalError=s.response.data.message||{})}this.loading=!1}},async fetchSessions(){this.loading=!0;try{await this.$axiosApi.get("gazprom-app/user/active-sessions",{headers:{"auth-token":localStorage.getItem("token")}}).then(({data:s})=>{if(s){const u=s.map(p=>({...p,contactNumber:p.contactNumber.slice(0,-3)+"***"}));this.activeSessions=u}}).catch(s=>{this.globalError=s.response.data.message||{}})}catch(s){console.log(s)}this.loading=!1},filterNumericInput(s,u){this.passwordData[s]=this.passwordData[s].replace(/\D/g,"").slice(0,u)}},mounted(){}},i=s=>(U("data-v-cd92cecb"),s=s(),M(),s),O={class:"settings-modal"},W={key:1},R=i(()=>a("p",{class:"settings-main-title"},"Настройки безопасности",-1)),Z={class:"settings-list"},q=i(()=>a("span",{class:"settings-title"},"Активные сессии",-1)),G=i(()=>a("span",{class:"settings-subtitle"},"Привязанные лицевые счета на других устройствах",-1)),H=[q,G],J=i(()=>a("span",{class:"settings-title"},"Смена PIN-кода",-1)),K=i(()=>a("span",{class:"settings-subtitle"},"Четырехзначный код для входа",-1)),Q=[J,K],Y={key:2,сlass:"wrapper"},$=i(()=>a("p",{class:"settings-main-title"},"Привязанные лицевые счета",-1)),s4={key:0,class:"active-sessions-list"},u4={key:0},e4=i(()=>a("p",{class:"info-text"},"Привязанных лицевых счетов на других устройствах нет",-1)),t4=[e4],o4={class:"account"},r4={class:"contact-number"},a4={key:1,style:{display:"flex","flex-direction":"column"}},n4=i(()=>a("div",{class:"info-text"}," Для удаления привязанных лицевых счетов на других устройствах, вам необходимо обратиться в колл-центр 4444. ",-1)),i4={key:3,сlass:"wrapper"},l4=i(()=>a("p",{class:"settings-main-title"},"Изменить пароль для входа",-1)),d4={key:0,class:"error-pass"},c4={key:0,class:"error-pass"},p4={key:1,class:"error-pass"},h4={key:2,class:"error-pass"};function m4(s,u,p,_4,e,l){var w;const f=x("Arrow"),P=T,h=L,v=B,y=X,m=I("maska");return o(),r("div",O,[e.step!=="settings"?(o(),E(f,{key:0,onClick:l.handleBackClick,class:"arrow-back"},null,8,["onClick"])):n("",!0),e.step==="settings"?(o(),r("div",W,[R,a("div",Z,[s.userProfile&&((w=s.userProfile)==null?void 0:w.facilities.length)>0?(o(),r("div",{key:0,class:"settings-item",onClick:u[0]||(u[0]=(...t)=>l.handleStep&&l.handleStep(...t))},H)):n("",!0),a("div",{class:"settings-item",onClick:u[1]||(u[1]=t=>e.step="changePin")},Q)])])):n("",!0),e.step==="sessions"?(o(),r("div",Y,[$,e.loading?(o(),r("div",a4,[(o(),r(D,null,k(3,t=>c(P,{key:t,style:{"border-radius":"32px",height:"40px",width:"100%",margin:"8px 0"}})),64))])):(o(),r("div",s4,[e.activeSessions.length===0?(o(),r("div",u4,t4)):n("",!0),(o(!0),r(D,null,k(e.activeSessions,t=>(o(),r("div",{key:t.id,class:"active-sessions-item"},[a("span",o4,"ЛС: "+d(t.account),1),a("span",r4,d(t.contactNumber),1)]))),128))])),n4])):n("",!0),e.step==="changePin"?(o(),r("div",i4,[l4,e.globalError?(o(),r("span",d4,d(e.globalError),1)):n("",!0),a("form",{class:"change-pin-form",onSubmit:u[8]||(u[8]=A((...t)=>l.changePassword&&l.changePassword(...t),["prevent"]))},[_(c(h,{placeholder:"XXXX",label:"Старый пароль",modelValue:e.passwordData.curPassCode,"onUpdate:modelValue":u[2]||(u[2]=t=>e.passwordData.curPassCode=t),inputType:"password",error:!!e.passwordError.curPassCode,onInput:u[3]||(u[3]=t=>l.filterNumericInput("curPassCode",4))},null,8,["modelValue","error"]),[[m,"****","unmaskedValue",{unmasked:!0}]]),e.passwordError.curPassCode?(o(),r("span",c4,d(e.passwordError.curPassCode),1)):n("",!0),_(c(h,{placeholder:"XXXX",label:"Новый пароль",modelValue:e.passwordData.newPassCode,"onUpdate:modelValue":u[4]||(u[4]=t=>e.passwordData.newPassCode=t),inputType:"password",error:!!e.passwordError.newPassCode,onInput:u[5]||(u[5]=t=>l.filterNumericInput("newPassCode",4))},null,8,["modelValue","error"]),[[m,"****","unmaskedValue",{unmasked:!0}]]),e.passwordError.newPassCode?(o(),r("span",p4,d(e.passwordError.newPassCode),1)):n("",!0),_(c(h,{placeholder:"XXXX",label:"Повторите пароль",modelValue:e.passwordData.reNewPassCode,"onUpdate:modelValue":u[6]||(u[6]=t=>e.passwordData.reNewPassCode=t),inputType:"password",error:!!e.passwordError.reNewPassCode,onInput:u[7]||(u[7]=t=>l.filterNumericInput("reNewPassCode",4))},null,8,["modelValue","error"]),[[m,"****","unmaskedValue",{unmasked:!0}]]),e.passwordError.reNewPassCode?(o(),r("span",h4,d(e.passwordError.reNewPassCode),1)):n("",!0),c(y,{text:e.loading?"":"Изменить пароль",withoutIcon:!0,bgColor:"#1852E0",style:{"align-self":"stretch","margin-top":"20px"}},{btnContent:V(()=>[e.loading?(o(),E(v,{key:0,loaderWidth:"10px",color:"white"})):n("",!0)]),_:1},8,["text"])],32)])):n("",!0)])}const E4=N(z,[["render",m4],["__scopeId","data-v-cd92cecb"]]);export{E4 as default};
