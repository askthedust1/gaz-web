import{j as V,_ as k,r as I,o as r,c as u,b as i,z as y,i as f,w as C,f as U,t as p,p as R,e as W,a1 as K,d as g,F as S,g as B,h,a2 as w,X as N,x as Z,W as Q,m as L,u as Y,R as q,k as x,l as ee,T as _,s as te,B as se,S as re}from"./index-CkxUTfic.js";import{_ as ae}from"./AccountsCarousel-Do9D7gQs.js";import{S as oe}from"./success-N5q6QwDn.js";import M from"./ErrorModal-BQPHmzkY.js";import O from"./AttachAccountModal-D6bhaHBg.js";import j from"./AuthModal-CPNRbsZv.js";import{_ as ue}from"./animated-gradient-B4alTJSn.js";import"./carousel-Yg1PrPl2.js";import"./edit-D59DAa3y.js";import"./instruction1-Cu5UfxlJ.js";import"./BaseInput-BcPL0qOn.js";import"./OTPInputs-CXxMFKzg.js";import"./left-arrow-back-Byi-bALH.js";const ne=V({name:"BaseCheckbox",props:{modelValue:{type:Boolean,required:!0,default:!1},label:String,error:Boolean||String,link:String},emits:["update:modelValue"],methods:{updateValue(e){this.$emit("update:modelValue",e)}}}),ie=e=>(R("data-v-887f0f8f"),e=e(),W(),e),le={class:"c-checkbox"},ce=["checked"],pe=ie(()=>i("span",null,null,-1));function me(e,t,s,n,a,l){const c=I("router-link");return r(),u("div",le,[i("label",{class:y([e.error?"error-input":"","checkbox-btn"])},[i("input",{type:"checkbox",checked:e.modelValue,onChange:t[0]||(t[0]=d=>e.updateValue(d.target.checked))},null,40,ce),pe],2),e.link?(r(),f(c,{key:0,class:y([e.error?"error-message":"","label link"]),to:{name:e.link},target:"_blank"},{default:C(()=>[U(p(e.label),1)]),_:1},8,["class","to"])):(r(),u("span",{key:1,class:y([e.error?"error-message":"","label"])},p(e.label),3))])}const E=k(ne,[["render",me],["__scopeId","data-v-887f0f8f"]]),he={components:{Multiselect:K},emits:["update:modelValue"],props:{modelValue:{type:Array,required:!0},label:String,options:Array,error:Boolean||String},data(){return{}},methods:{emitChange(e){this.$emit("update:modelValue",e)}}},de={class:"c-multiselect"},fe={class:"c-multiselect-label"};function ge(e,t,s,n,a,l){const c=I("Multiselect");return r(),u("div",de,[i("label",fe,p(s.label),1),g(c,{placeholder:"Не выбрано","v-model":s.modelValue,onChange:l.emitChange,class:y(["multiselect-blue",s.error?"error":""]),mode:"tags","close-on-select":!1,searchable:!0,"create-option":!0,options:s.options},null,8,["v-model","onChange","class","options"])])}const z=k(he,[["render",ge],["__scopeId","data-v-68a75f26"]]),ye=V({props:{id:{type:String,required:!1,default:()=>`select-${Math.random().toString(36).substr(2,9)}`},defaultValue:String,name:{type:String,required:!1},label:{type:String,required:!1},options:{type:Array,required:!0},modelValue:{type:[String,Number],required:!1},placeholder:{type:String,required:!1},required:{type:Boolean,required:!1,default:!1},error:{type:[Boolean,String],required:!1}},emits:["update:modelValue"],methods:{handleInput(e){const t=e.target;this.$emit("update:modelValue",t.value)}}}),ke={class:"select-container"},be=["for"],_e=["id","name","value","required"],De={value:"",disabled:"",hidden:""},Fe=["value"];function ve(e,t,s,n,a,l){return r(),u("div",ke,[i("label",{for:e.id,class:"select-label"},p(e.label),9,be),i("select",{id:e.id,name:e.name,value:e.modelValue,onInput:t[0]||(t[0]=(...c)=>e.handleInput&&e.handleInput(...c)),required:e.required,class:y(["select-input",e.error?"error":""])},[i("option",De,p(e.placeholder||e.label||e.defaultValue),1),(r(!0),u(S,null,B(e.options,(c,d)=>(r(),u("option",{key:d,value:c},p(c),9,Fe))),128))],42,_e)])}const T=k(ye,[["render",ve],["__scopeId","data-v-f821888d"]]),Ce=V({name:"BaseInput",emits:["update:modelValue","blur"],props:{modelValue:String,label:String,error:Boolean||String,date:String,placeholder:String,isDisabled:Boolean,regax:String,inputType:{required:!1},min:Number,max:Number},data(){return{}}}),Se={class:"c-text-box-wrapper"},Be={class:"c-text-box-label-wrapper"},Ee={key:0,class:"c-text-box-label"},Ve={class:"c-text-box"},Ie=["placeholder","value","disabled","minLength","maxLength","pattern","type"];function Pe(e,t,s,n,a,l){return r(),u("label",null,[i("div",Se,[i("div",Be,[e.label?(r(),u("span",Ee,p(e.label),1)):h("",!0)]),i("div",Ve,[i("input",{ref:"input",class:y(["input",e.error?"error":""]),placeholder:e.placeholder,value:e.modelValue,disabled:e.isDisabled,minLength:e.min,maxLength:e.max,pattern:e.regax,type:e.inputType==="numbers"?"number":"text",onBlur:t[0]||(t[0]=c=>e.$emit("blur",c)),onInput:t[1]||(t[1]=c=>{var d;return e.$emit("update:modelValue",((d=c.target)==null?void 0:d.value)??"")})},null,42,Ie)])])])}const v=k(Ce,[["render",Pe],["__scopeId","data-v-f32654b5"]]),$e={components:{BaseServicesInput:v,AuthModal:j,AttachAccountModal:O,SuccessIcon:oe,BaseSelect:T,BaseFilePicker:w,BaseDatepicker:N,BaseButton:Z,BaseCheckbox:E,BaseMultiselect:z,ErrorModal:M},directives:{maska:Q},data(){return{step:"",application:{},passportFields:["surname","name","lastName","inn","gender","birthday","passportNum","passportIssuedDate","passportIssuedBy"],fields:{},formData:{},errors:{},formName:{},files:[],passportObject:{},loading:!1,loadingForm:!1,isAgree:!1,globalError:"",refreshPassportData:!1,isSuccess:!1,hasAccount:!1}},computed:{...L(Y,["currentLang"]),...L(q,["userProfile","token","loadingProfile"])},watch:{formData:{handler(e){this.refreshPassportData=Object.keys(this.passportObject).length===0||this.passportFields.some(t=>e[t]!==this.passportObject[t])},deep:!0}},methods:{...x(q,["fetchUserProfile"]),...x(ee,["open"]),clearError(e){this.errors[e]=""},handleOnClickOpenModal(){this.open(O)},openAuthMoadal(){this.open(j)},validateField(e){const t=this.formData[e.key],s={required:"Это поле обязательно для заполнения",minLength:`Минимальная длина: ${e.minLength} символов`,maxLength:`Максимальная длина: ${e.maxLength} символов`,regex:"Неверный формат",phone:"Неверный формат телефона"};e.isRequired&&!t?this.errors[e.key]=s.required:e.minLength&&t.length<e.minLength?this.errors[e.key]=s.minLength:e.maxLength&&t.length>e.maxLength?this.errors[e.key]=s.maxLength:e.key==="email"?t&&(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())||(this.errors[e.key]=s.regex)):e.regax&&!new RegExp(e.regax).test(t)?this.errors[e.key]=s.regex:["contactNumber","additionalNumber"].includes(e.key)?this.validatePhoneNumber(e.key,t):e.type.key==="file"&&(!t||t.length<1)?this.errors[e.key]=s.required:e.type.key==="multiselect"&&t.length<1?this.errors[e.key]=s.required:this.errors[e.key]=""},changeData(e){this.formData.account=e.account},validatePhoneNumber(e,t){const s=/^\+?\d+$/.test(t),n={contactNumber:"Неверный формат телефона +996#########",additionalNumber:"Неверный формат"};e==="contactNumber"&&(!s||t.length!==13)?this.errors[e]=n.contactNumber:e==="additionalNumber"&&!s&&t!=="+996"?(this.errors[e]=n.additionalNumber,this.formData[e]="+996"):this.errors[e]=""},validateForm(){this.errors={};let e=null;return Object.values(this.fields).forEach(t=>{t.data.forEach(s=>{this.validateField(s),this.errors[s.key]&&!e&&(e=this.$refs[`${s.key}`])})}),e&&e[0].scrollIntoView({behavior:"smooth",block:"center"}),Object.values(this.errors).every(t=>!t)},async submitForm(){if(this.loading=!0,this.validateForm()){const e=this.prepareFormData();try{await this.$axiosApi.post("applications",e,{headers:{"Content-Type":"multipart/form-data"}}).then(({data:t})=>{t&&(this.application=t,this.loading=!1,this.step="success",this.isSuccess=!0)})}catch(t){console.log(t),t.response&&t.response.data&&this.open(M,{message:t.response.data.message})}this.refreshPassportData&&this.isAgree&&this.sendNewPassportData()}this.loading=!1},prepareFormData(){const e=new FormData;return Object.entries(this.formData).forEach(([t,s])=>{if(Array.isArray(s)&&s.every(n=>n instanceof File))s.forEach(n=>e.append("files",this.renameFile(n,t)));else if(Array.isArray(s)&&s.every(n=>typeof n=="string"))s.forEach(n=>e.append(t,n));else if(s!=="+996"&&s!==null){if(t==="additionalNumber"||t==="contactNumber"){e.append(t,s.replace("+",""));return}e.append(t,s)}}),e},renameFile(e,t){let s=e.name;return t==="passportScan"&&(s="passport-scan"+e.name),t==="techPassportScan"&&(s="tech-passport-scan"+e.name),new File([e],s,{type:e.type})},sendNewPassportData(){const e={};if(this.passportFields.forEach(t=>{if(t==="passportNum"){e.passportNumber=this.formData[t];return}e[t]=this.formData[t]}),Object.keys(e).length>0)try{this.$axiosApi.put("gazprom-app/client",e).then(({data:t})=>{t&&console.log("Паспортные данные обновлены")})}catch(t){t.response&&t.response.data&&(this.globalError=t.response.data.message||{})}},async fetchServicesForm(e){this.loadingForm=!0;try{await this.$axiosApi.get("applications/form-fields?key="+e,{headers:{"Content-Type":"application/json","auth-token":localStorage.getItem("token")}}).then(({data:t})=>{t&&(this.formName=t.name,this.fields=t.data,this.loadingForm=!1,this.formName[this.currentLang]&&(document.title=`${this.formName[this.currentLang]} - Газпром`))})}catch(t){console.log(t),this.loadingForm=!1}},initializeFormData(){this.formData.key=this.$route.params.id,Object.keys(this.fields).forEach(e=>{(e==="passportData"||e==="ownerInfo")&&this.fields[e].data.forEach(t=>{if(t.key==="account"){this.hasAccount=!0;return}t.defaultValue&&t.type.key!=="file"&&(this.passportObject[t.key]=t.defaultValue)}),this.fields[e].data.forEach(t=>{var s;if(t.type.key==="file"){this.formData[t.key]=null;return}if(t.type.key==="multiselect"){this.formData[t.key]=t.defaultValue||[];return}if(t.key==="account"){this.userProfile?this.userProfile.facilities&&(this.formData[t.key]=(s=this.userProfile)==null?void 0:s.facilities[0].account):this.formData[t.key]=t.defaultValue;return}if(t.key==="contactNumber"){this.userProfile?this.userProfile.contactNumber&&(this.formData[t.key]="+"+this.userProfile.contactNumber):this.formData[t.key]="";return}if(t.key==="email"){this.userProfile?this.userProfile.email&&(this.formData[t.key]=this.userProfile.email):this.formData[t.key]="";return}if(t.type.key==="checkbox"){this.formData[t.key]=!1;return}if(t.type.key==="date_select"){t.defaultValue?this.formData[t.key]=t.defaultValue:this.formData[t.key]="";return}this.formData[t.key]=t.defaultValue||null})})},async handleFormInitialization(){await this.fetchServicesForm(this.$route.params.id),this.initializeFormData(),this.step="form"},formatDate(e){const t=e.split("-"),s=parseInt(t[0]),n=parseInt(t[1]),a=parseInt(t[2]);return new Date(a,n-1,s)},getComponent(e){switch(e){case"text":case"multiline_text":case"numbers":return v;case"select":return T;case"multiselect":return z;case"date_select":return N;case"checkbox":return E;case"file":return w;default:return v}}},async beforeMount(){var e;if((localStorage.getItem("token")||this.token)&&await this.fetchUserProfile(this.$axiosApi),!this.userProfile&&this.$route.params.id==="NGV4"){this.handleFormInitialization();return}else if(this.userProfile&&!((e=this.userProfile.facilities)!=null&&e.length)){this.step="attach";return}else if(!this.userProfile){this.step="register";return}this.handleFormInitialization()}},D=e=>(R("data-v-2446d544"),e=e(),W(),e),Ae={key:0,class:"container"},we={key:0,class:"group-title"},Ne={class:"accounts-wrap"},Le={key:0,class:"error-message"},qe={key:2,class:"attach",style:{"text-align":"center"}},xe=D(()=>i("h1",null,"Войдите или зарегистрируйтесь, чтобы отправить заявку",-1)),Me={key:3,class:"attach",style:{"text-align":"center"}},Oe=D(()=>i("h1",null,"Чтобы отправить заявку необходимо привязать лицевой счет",-1)),je={key:4,class:"success"},ze=D(()=>i("h3",{class:"success-title"},"Ваша заявка принята!",-1)),Te={key:0},Ue={key:1,class:"preloader"},Re=D(()=>i("div",{class:"loading"},[i("img",{src:ue,alt:"loading"})],-1)),We=[Re];function Ze(e,t,s,n,a,l){var P;const c=te,d=ae,G=E,X=re,b=Z,H=I("SuccessIcon");return!a.loadingForm&&!e.loadingProfile?(r(),u("div",Ae,[a.isSuccess?h("",!0):(r(),f(c,{key:0,tag:"h2",size:"small"},{default:C(()=>[U(p(a.formName[e.currentLang]),1)]),_:1})),a.step==="form"?(r(),u("form",{key:1,class:"service-form",method:"post",onSubmit:t[1]||(t[1]=_((...m)=>l.submitForm&&l.submitForm(...m),["prevent"]))},[(r(!0),u(S,null,B(a.fields,(m,J)=>{var $,A;return r(),u("div",{key:J},[m.key!=="other"&&m.key!=="none"?(r(),u("h3",we,p(m.name[e.currentLang]),1)):h("",!0),i("div",Ne,[e.userProfile&&(($=e.userProfile)!=null&&$.facilities)&&m.key==="ownerInfo"&&a.hasAccount?(r(),f(d,{key:0,items:(A=e.userProfile)==null?void 0:A.facilities,showIcon:!1,onChangeFacility:l.changeData,style:{width:"100% !important"}},null,8,["items","onChangeFacility"])):h("",!0)]),(r(!0),u(S,null,B(m.data,o=>(r(),u("div",{key:o.key,ref_for:!0,ref:o.key,class:"field-wrap"},[(r(),f(se(l.getComponent(o.type.key)),{modelValue:a.formData[o.key],"onUpdate:modelValue":F=>a.formData[o.key]=F,id:o.key,name:o.key,required:o.isRequired,error:!!a.errors[o.key],placeholder:o.placeholder!==null?o.placeholder[e.currentLang]:o.placeholder,regax:o.regax,inputType:o.type.key,label:o.name[e.currentLang],min:o.minLength,max:o.maxLength,options:o.options,link:"AgreementPage",onBlur:F=>l.validateField(o),onInput:F=>l.clearError(o.key),accept:"image/*,application/pdf"},null,40,["modelValue","onUpdate:modelValue","id","name","required","error","placeholder","regax","inputType","label","min","max","options","onBlur","onInput"])),a.errors[o.key]&&o.type.key!=="file"&&o.type.key!=="checkbox"&&o.type.key!=="date_select"?(r(),u("span",Le,p(a.errors[o.key]),1)):h("",!0)]))),128))])}),128)),e.userProfile&&!((P=e.userProfile)!=null&&P.client)||e.userProfile&&e.userProfile.client&&a.refreshPassportData?(r(),f(G,{key:0,modelValue:a.isAgree,"onUpdate:modelValue":t[0]||(t[0]=m=>a.isAgree=m),label:"Обновить идентификацию",style:{"margin-top":"20px"}},null,8,["modelValue"])):h("",!0),i("span",null,p(a.globalError),1),g(b,{text:"Отправить",withoutIcon:!0,bgColor:"#1852E0",disabledBtn:a.loading,style:{"margin-top":"30px"}},{btnContent:C(()=>[a.loading?(r(),f(X,{key:0,loaderWidth:"10px",color:"white",style:{"margin-left":"10px"}})):h("",!0)]),_:1},8,["disabledBtn"])],32)):a.step==="register"?(r(),u("div",qe,[xe,g(b,{text:"Войти или зарегистрироваться",withoutIcon:!0,bgColor:"#1852E0",style:{"margin-top":"30px","align-self":"center !important"},onClick:_(l.openAuthMoadal,["prevent"])},null,8,["onClick"])])):a.step==="attach"?(r(),u("div",Me,[Oe,g(b,{text:"Привязать лицевой счет",withoutIcon:!0,bgColor:"#1852E0",style:{"margin-top":"30px","align-self":"center !important"},onClick:_(l.handleOnClickOpenModal,["prevent"])},null,8,["onClick"])])):a.step==="success"?(r(),u("div",je,[g(H),ze,e.userProfile?(r(),u("p",Te,"Вы можете отследить статус заявки в личном кабинете")):h("",!0),g(b,{text:"Вернуться на главную",withoutIcon:!0,bgColor:"#1852E0",style:{"margin-top":"30px","align-self":"center"},onClick:t[2]||(t[2]=_(m=>e.$router.push("/"),["prevent"]))})])):h("",!0)])):(r(),u("div",Ue,We))}const ut=k($e,[["render",Ze],["__scopeId","data-v-2446d544"]]);export{ut as default};
