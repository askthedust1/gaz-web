import{a as w}from"./AccountsCarousel-H9rzhbfF.js";import{x as y,W as C,m as I,R as f,k as E,l as F,_ as b,Z as V,o as e,c as n,T as g,t as l,h as i,d as c,b as a,C as D,i as h,w as p,p as M,e as X,S as W}from"./index-iNDi3pII.js";import{_ as A,a as T}from"./instruction1-CzpIqU05.js";import{_ as B}from"./BaseInput-Bo-vNbAW.js";import U from"./ErrorModal-CHNpXWY4.js";import"./carousel-BOe6zjUw.js";import"./edit-DBiVh5tl.js";const N={components:{BaseButton:y,BaseInput:B,AccountItem:w,BaseInputWithTooltip:A},directives:{maska:C},data(){return{step:"search",facility:{},account:"",owner:"",errors:{accountError:"",ownerError:""},errorMsg:"",loadingSerach:!1,loadingAttach:!1}},computed:{...I(f,["userProfile","token"])},methods:{...E(F,["close","open"]),...E(f,["fetchUserProfile"]),async attachAccount(){this.loadingAttach=!0;try{const{data:r}=await this.$axiosApi.post(`/gazprom-app/user/facility/${this.facility.account}`,{},{headers:{"auth-token":this.token}});if(r){if(this.close(),this.$route.path.startsWith("/consumers/services/")){window.location.reload();return}await this.fetchUserProfile(this.$axiosApi)}}catch(r){console.error(r),this.open(U,{message:"Произошла ошибка при привязке лицевого счета"})}finally{this.loadingAttach=!1}},async serachFacility(){if(this.validate()){this.loadingSerach=!0;try{const{data:r}=await this.$axiosApi.get(`/facility/account?account=${this.account}&credentials=${this.owner}`,{headers:{"api-token":"WEB483122E4389443a9bae7f7546Dcdc438"}});if(r.length===0){this.errorMsg="Лицевой счет не найден";return}this.facility=r,this.step="attach"}catch(r){console.error(r),this.errorMsg=r.response.data.message}finally{this.loadingSerach=!1}}},validate(){return this.clearErrors(),(!this.account||this.account.length<9)&&(this.errors.accountError="Введите корректный лицевой счет (минимум 9 символов)"),this.account.trim()||(this.errors.accountError="Введите лицевой счет объекта"),this.owner.trim()||(this.errors.ownerError="Введите ФИО владельца объекта"),!this.errors.accountError&&!this.errors.ownerError},clearError(r){this.errors[r]=""},limitInput(r,o){this[r].toString().length>o&&(this[r]=this[r].toString().slice(0,o))},clearErrors(){this.errors.accountError="",this.errors.ownerError=""}}},m=r=>(M("data-v-15f21286"),r=r(),X(),r),P={class:"attach-account"},z=m(()=>a("h3",null,"Привязка лицевого счета",-1)),R={key:0,class:"error-msg"},Z={key:1,class:"error-msg"},j={class:"account"},q=m(()=>a("img",{src:T,style:{width:"100%"},alt:"instruction"},null,-1)),G={class:"error-msg"},H=m(()=>a("h3",null,"Результаты поиска",-1));function J(r,o,K,L,t,s){const k=B,x=A,d=W,_=y,S=w,v=V("maska");return e(),n("div",P,[t.step==="search"?(e(),n("form",{key:0,onSubmit:o[4]||(o[4]=g((...u)=>s.serachFacility&&s.serachFacility(...u),["prevent"])),class:"identification-form"},[z,t.errorMsg?(e(),n("span",R,l(t.errorMsg),1)):i("",!0),c(k,{modelValue:t.owner,"onUpdate:modelValue":o[0]||(o[0]=u=>t.owner=u),error:!!t.errors.ownerError,placeholder:"ФИО",label:"Введите ФИО владельца объекта"},null,8,["modelValue","error"]),t.errors.ownerError?(e(),n("span",Z,l(t.errors.ownerError),1)):i("",!0),a("div",j,[D((e(),h(x,{modelValue:t.account,"onUpdate:modelValue":o[1]||(o[1]=u=>t.account=u),label:"Лицевой счет",placeholder:"XXXXXXXXX",inputType:"text",tooltip:!0,tooltipText:"Введите лицевой счет - указан в квитанции на оплату, например: <b style='color: #FC4E3C;'>010002733</b> (должен состоять из 9 цифр).",hasError:!!t.errors.accountError,onClearError:o[2]||(o[2]=u=>s.clearError("accountError")),onInput:o[3]||(o[3]=u=>s.limitInput("account",9))},{"image-content":p(()=>[q]),_:1},8,["modelValue","hasError"])),[[v,"#########","unmaskedValue",{unmasked:!0}]]),a("span",G,l(t.errors.accountError),1)]),c(_,{text:t.loadingSerach?"":"Поиск",withoutIcon:!0,bgColor:"#1852E0",style:{"margin-top":"40px !important","align-self":"stretch"}},{btnContent:p(()=>[t.loadingSerach?(e(),h(d,{key:0,loaderWidth:"10px",color:"white"})):i("",!0)]),_:1},8,["text"])],32)):t.facility&&t.step==="attach"?(e(),n("form",{key:1,onSubmit:o[5]||(o[5]=g((...u)=>s.attachAccount&&s.attachAccount(...u),["prevent"])),class:"identification-form"},[H,c(S,{account:t.facility.account,address:t.facility.address,owner:t.facility.owner},null,8,["account","address","owner"]),c(_,{text:t.loadingAttach?"":"Привязать",withoutIcon:!0,bgColor:"#1852E0",style:{"align-self":"stretch","margin-top":"20px"}},{btnContent:p(()=>[t.loadingAttach?(e(),h(d,{key:0,loaderWidth:"10px",color:"white"})):i("",!0)]),_:1},8,["text"])],32)):i("",!0)])}const ut=b(N,[["render",J],["__scopeId","data-v-15f21286"]]);export{ut as default};
