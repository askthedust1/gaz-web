import{o as n,c as p,b as o,W as S,V as T,a3 as v,k as C,l as Z,c5 as A,_ as R,r as B,Z as Q,d as a,i as h,h as m,t as f,C as F,w as N,az as U,z as W,T as z,a2 as H,x as J,S as O}from"./index-CkxUTfic.js";import{_ as D,a as x}from"./instruction1-Cu5UfxlJ.js";import{Q as q,_ as L}from"./BaseInput-BcPL0qOn.js";import{_ as V}from"./AccountsCarousel-Do9D7gQs.js";import"./carousel-Yg1PrPl2.js";import"./edit-D59DAa3y.js";const j={xmlns:"http://www.w3.org/2000/svg",width:"52",height:"58",fill:"none"},G=o("path",{fill:"#1852E0",stroke:"#1852E0","stroke-width":".56",d:"M22.508 19.651a6.435 6.435 0 0 0-6.427-6.427 6.435 6.435 0 0 0-6.426 6.427 6.434 6.434 0 0 0 6.426 6.427 6.434 6.434 0 0 0 6.427-6.427Zm-10.378 0a3.95 3.95 0 0 1 3.943-3.943 3.95 3.95 0 0 1 3.943 3.943 3.95 3.95 0 0 1-3.943 3.943 3.95 3.95 0 0 1-3.943-3.943ZM15.49 43.596h-5.308v-7.645c0-.56-.45-1.01-1.01-1.01-.558 0-1.008.45-1.008 1.01v7.645H5.905c-.1 0-.21-.078-.21-.21V35.92c0-3.314 2.702-6.016 6.016-6.016h8.615c1.204 0 2.275.334 3.276 1.017a1.234 1.234 0 0 0 1.723-.325 1.24 1.24 0 0 0-.326-1.724 8.14 8.14 0 0 0-4.673-1.451h-8.615c-4.688 0-8.5 3.811-8.5 8.499v7.466a2.7 2.7 0 0 0 2.694 2.694h9.586c.683 0 1.242-.559 1.242-1.242s-.559-1.242-1.242-1.242ZM38.031 33.428a5.923 5.923 0 0 0 5.914-5.914 5.92 5.92 0 0 0-5.914-5.914 5.923 5.923 0 0 0-5.915 5.914 5.923 5.923 0 0 0 5.915 5.914Zm0-9.345a3.432 3.432 0 0 1 0 6.862 3.433 3.433 0 0 1-3.431-3.431 3.433 3.433 0 0 1 3.431-3.431ZM47.33 36.93a7.56 7.56 0 0 0-5.449-2.281h-7.9399999999999995a4 4 0 0 0-.675.022 1.242 1.242 0 0 0 .147 2.477c.047 0 .1 0 .148-.009.077-.007.194-.007.325-.007h7.988c1.396 0 2.7.543 3.67 1.536.97.995 1.506 2.33 1.506 3.758v6.744c0 .04-.015.063-.062.063h-1.444v-6.776c0-.56-.45-1.01-1.008-1.01-.559 0-1.01.45-1.01 1.01v6.776h-5.58c-.683 0-1.242.558-1.242 1.241 0 .684.559 1.242 1.242 1.242h9.042a2.547 2.547 0 0 0 2.546-2.546v-6.744c.008-2.089-.776-4.037-2.204-5.496Z"},null,-1),K=o("path",{fill:"#1852E0",stroke:"#1852E0","stroke-width":".56",d:"M21.235 36.929a4.98 4.98 0 0 0 4.975 4.975 4.98 4.98 0 0 0 4.975-4.975 4.98 4.98 0 0 0-4.975-4.975 4.98 4.98 0 0 0-4.975 4.975Zm4.975-2.491a2.495 2.495 0 0 1 2.492 2.49 2.495 2.495 0 0 1-2.492 2.493 2.494 2.494 0 0 1-2.49-2.492 2.494 2.494 0 0 1 2.49-2.491ZM33.786 44.753a6.3 6.3 0 0 0-4.541-1.91h-6.201a6.48 6.48 0 0 0-6.474 6.473v5.388A2.3 2.3 0 0 0 18.868 57H33.35c1.25 0 2.266-1.032 2.266-2.297v-5.388a6.4 6.4 0 0 0-1.831-4.563Zm-10.735.574h6.202c1.048 0 2.034.412 2.763 1.164a4.03 4.03 0 0 1 1.133 2.825v5.201h-.745v-5.169c0-.559-.45-1.009-1.01-1.009-.558 0-1.008.45-1.008 1.01v5.168h-8.173v-5.169c0-.559-.45-1.009-1.01-1.009-.558 0-1.008.45-1.008 1.01v5.168h-1.133v-5.2a3.99 3.99 0 0 1 3.99-3.99ZM50.84 14.808l-7.235-3.562V3.119A2.097 2.097 0 0 0 41.486 1h-5.115a2.097 2.097 0 0 0-2.118 2.119v3.54l-7.274-3.54a2.63 2.63 0 0 0-2.313 0L1.164 14.629a1.32 1.32 0 0 0-.606 1.763 1.326 1.326 0 0 0 1.77.605l23.495-11.51 9.159 4.462.046.024c.008 0 .016.007.024.007.03.016.07.023.1.04.008 0 .016.007.023.007.04.008.07.023.11.031h.015c.04.008.078.015.125.015a1 1 0 0 0 .131.008c.039 0 .086 0 .124-.008h.032c.03 0 .07-.007.1-.015h.023l.102-.023c.015-.008.03-.008.038-.015l.07-.024c.015-.008.024-.008.04-.016l.092-.046c.008-.008.015-.008.032-.016.023-.015.053-.03.077-.046.008-.008.015-.008.023-.016.062-.046.124-.093.178-.148l.017-.015c.022-.023.046-.054.07-.078 0-.007.007-.007.007-.015l.07-.094c0-.007.008-.007.008-.015.015-.023.03-.054.046-.078.007-.015.016-.022.023-.038.008-.008.008-.016.016-.024.008-.007.008-.015.008-.022.007-.024.023-.047.03-.078a.1.1 0 0 0 .017-.047l.022-.07c.008-.023.008-.038.016-.062.007-.023.007-.038.015-.062.009-.023.009-.047.009-.07 0-.016.007-.039.007-.054 0-.031 0-.054.008-.085V3.63h4.082v8.46c0 .024 0 .055.008.078 0 .016 0 .04.008.054 0 .024.008.047.008.07s.008.047.015.063c.008.015.008.038.016.054l.023.07c.008.015.008.03.015.046.009.024.016.047.032.07l.023.047c.007.023.023.046.031.062.008.015.023.038.03.054.008.016.024.039.032.054l.047.063c.007.015.022.03.03.039.016.023.032.038.054.061.009.016.024.024.032.031.015.016.039.031.054.055.016.016.031.023.04.038.014.016.038.024.054.04.015.015.038.022.053.038a.14.14 0 0 1 .047.031c.024.016.047.024.07.039.008 0 .008.008.016.008l7.97 3.928a1.314 1.314 0 0 0 1.77-.599 1.33 1.33 0 0 0-.596-1.777Z"},null,-1),Y=[G,K];function $(e,u){return n(),p("svg",j,[...Y])}const u0={render:$},e0={components:{Recalculation:u0,QuestionIcon:q,AccountsCarousel:V,BaseInputWithTooltip:D,Image1:x},name:"RecalculationModal",directives:{maska:S},props:{image:String},data(){return{loading:!1,userProfile:null,tokenCookie:void 0,userAccount:"",unmaskedValue:"",fullName:"",tel:"996",file:[],formErrors:{userAccount:"",fullName:"",tel:"",readings:""}}},computed:{...T(v),filteredFacilities(){var e,u;return((u=(e=this.userProfile)==null?void 0:e.facilities)==null?void 0:u.filter(r=>r.account))||[]},formattedPhone(){return"996"+this.unmaskedValue}},methods:{...C(Z,["close"]),...C(v,["connect","openChat","setChatCookie"]),validateFields(){var u;this.formErrors={userAccount:"",fullName:"",tel:"",readings:""};let e=!0;if((!this.userAccount||this.userAccount.length<9)&&(this.formErrors.userAccount="Введите корректный лицевой счет (минимум 9 символов)",e=!1),(!this.fullName||this.fullName.length<3)&&(this.formErrors.fullName="Введите корректное ФИО (минимум 3 символа)",e=!1),!((u=this.userProfile)!=null&&u.contactNumber)){const r=/^996\d{9}$/;(!this.tel||!r.test(this.tel))&&(this.formErrors.tel="Введите номер в формате 996XXXXXXXXX (12 цифр)",e=!1)}return this.file.length||(this.formErrors.readings="Загрузите фото газового счетчика",e=!1),e},clearError(e){this.formErrors[e]=""},limitInput(e,u){this[e].toString().length>u&&(this[e]=this[e].toString().slice(0,u))},changeData(e){this.userAccount=e.account,this.fullName=e.owner},setToken(e){if(!e.phone.trim()&&!e.name.trim())return;const u=this.generateToken(),{cookies:r}=A(),i={token:u,fullname:e.name,contactNumber:e.phone};r.set("user",JSON.stringify(i),"1d"),this.tokenCookie=u,this.setChatCookie(u),this.connect()},generateToken(){const e=Math.random().toString(36).slice(2),u=Date.now().toString(36);return`${e}${u}`},sendRecalculation(){var r;if(!this.validateFields())return;const e=((r=this.userProfile)==null?void 0:r.contactNumber)||this.tel,u=this.getCookie();!u&&!this.userProfile?this.setToken({name:this.fullName,phone:e}):!u&&this.userProfile?console.log(this.userProfile):this.tokenCookie=u,setTimeout(()=>this.openChat(),1e3),this.close(),setTimeout(()=>this.chatMessagesStore.createItem(`Тестовое соообщение. Ведется разработка перерасчета. ЛС:${this.userAccount}, ФИО: ${this.fullName}, Телефон: ${e}`,this.file[0]),2500)},getCookie(){const{cookies:e}=A(),u=e.get("user");return u==null?void 0:u.token}},async beforeMount(){var u,r,i,t,s,c;const e=localStorage.getItem("user");e&&(this.userProfile=JSON.parse(e),this.tel=((u=this.userProfile)==null?void 0:u.contactNumber)||"",(r=this.userProfile)!=null&&r.facilities.length?(this.userAccount=(i=this.userProfile)==null?void 0:i.facilities[0].account,this.fullName=(t=this.userProfile)==null?void 0:t.facilities[0].owner):this.userProfile&&(this.fullName=((c=(s=this.userProfile)==null?void 0:s.client)==null?void 0:c.name)||""))}},t0={class:"recalculation-modal"},o0={class:"recalculation-header"},s0={class:"header"},r0=o("h3",null,"Перерасчет начисления",-1),l0={class:"tooltip-wrapper"},n0=o("div",{class:"tooltip tooltip-head"}," Если показания газового счетчика отличаются от того, что указанно в квитанции или вы обнаружили ошибку в расчетах потребления газа, вы можете оставить заявку на перерасчет. Мы проведем проверку и предоставим результат в течение месяца. ",-1),i0={class:"recalculation-form"},c0={class:"error-recalc"},a0=o("img",{src:x,alt:"instruction"},null,-1),h0={class:"error-recalc"},m0={key:2},f0={class:"c-text-box-wrapper"},p0=o("div",{style:{display:"flex","align-items":"center",gap:"10px"}},[o("span",{class:"c-text-box-label"},"Номер мобильного телефона")],-1),d0={class:"c-text-box"},_0={class:"error-recalc"},E0={class:"upload-photo"},g0=o("div",{class:"label"},"Внесите фото газового счетчика",-1),k0={class:"error-recalc"};function v0(e,u,r,i,t,s){var _,E,g,k;const c=B("Recalculation"),P=B("QuestionIcon"),w=V,b=L,y=D,X=H,I=O,M=J,d=Q("maska");return n(),p("div",t0,[o("div",o0,[a(c,{style:{"align-self":"center"}}),o("div",s0,[r0,o("div",l0,[a(P,{class:"question-icon"}),n0])])]),o("form",i0,[(_=t.userProfile)!=null&&_.facilities&&s.filteredFacilities.length>0?(n(),h(w,{key:0,items:s.filteredFacilities,showIcon:!1,onChangeFacility:s.changeData,style:{"align-self":"normal !important",width:"100% !important"}},null,8,["items","onChangeFacility"])):m("",!0),!((E=t.userProfile)!=null&&E.facilities)||s.filteredFacilities.length===0||!((g=t.userProfile)!=null&&g.client)?(n(),h(b,{key:1,placeholder:"ФИО",modelValue:t.fullName,"onUpdate:modelValue":u[0]||(u[0]=l=>t.fullName=l),label:"Введите ФИО владельца объекта",error:!!t.formErrors.fullName,onInput:u[1]||(u[1]=l=>s.clearError("fullName"))},null,8,["modelValue","error"])):m("",!0),o("span",c0,f(t.formErrors.fullName),1),F((n(),h(y,{modelValue:t.userAccount,"onUpdate:modelValue":u[2]||(u[2]=l=>t.userAccount=l),label:"Лицевой счет",placeholder:"XXXXXXXXX",inputType:"text",tooltip:!0,tooltipText:"Введите лицевой счет - указан в квитанции на оплату, например: <b style='color: #FC4E3C;'>010002733</b> (должен состоять из 9 цифр).",hasError:!!t.formErrors.userAccount,onClearError:u[3]||(u[3]=l=>s.clearError("userAccount")),onInput:u[4]||(u[4]=l=>s.limitInput("userAccount",9))},{"image-content":N(()=>[a0]),_:1},8,["modelValue","hasError"])),[[d,"#########","unmaskedValue",{unmasked:!0}]]),o("span",h0,f(t.formErrors.userAccount),1),(k=t.userProfile)!=null&&k.contactNumber?m("",!0):(n(),p("label",m0,[o("div",f0,[p0,o("div",d0,[F(o("input",{type:"text",class:W(["input",{error:t.formErrors.tel}]),placeholder:"996","onUpdate:modelValue":u[5]||(u[5]=l=>t.tel=l),onInput:u[6]||(u[6]=l=>s.clearError("tel"))},null,34),[[d,"996#########","unmaskedValue",{unmasked:!0}],[U,t.tel]])])])])),o("span",_0,f(t.formErrors.tel),1),o("div",E0,[g0,a(X,{modelValue:t.file,"onUpdate:modelValue":u[7]||(u[7]=l=>t.file=l),style:{"margin-top":"5px"},accept:"image/*",error:!!t.formErrors.readings,onInput:u[8]||(u[8]=l=>s.clearError("readings"))},null,8,["modelValue","error"]),o("span",k0,f(t.formErrors.readings),1)]),a(M,{onClick:z(s.sendRecalculation,["prevent"]),text:t.loading?"":"Отправить",withoutIcon:!0,bgColor:"#1852E0",style:{"margin-top":"30px !important","align-self":"stretch"}},{btnContent:N(()=>[t.loading?(n(),h(I,{key:0,loaderWidth:"10px",color:"white"})):m("",!0)]),_:1},8,["onClick","text"])])])}const x0=R(e0,[["render",v0]]);export{x0 as default};
