import{o,c as m,b as n,W as P,x as B,k as g,l as V,R,u as M,_ as N,r as X,Z as T,d as f,h as c,i as d,C as v,w as p,t as h,f as U,p as W,e as q,S as z}from"./index-CkxUTfic.js";import{_ as I,Q as H}from"./BaseInput-BcPL0qOn.js";import{_ as k,a as L}from"./instruction1-Cu5UfxlJ.js";import{_ as Q}from"./AccountsCarousel-Do9D7gQs.js";import _ from"./ErrorModal-BQPHmzkY.js";import"./carousel-Yg1PrPl2.js";import"./edit-D59DAa3y.js";const J={xmlns:"http://www.w3.org/2000/svg",width:"56",height:"57",fill:"none"},O=n("path",{fill:"#1852E0","fill-rule":"evenodd",d:"M0 28.703c0-15.416 12.583-28 28-28s28 12.583 28 28-12.583 28-28 28-28-12.582-28-28m3.281 0c0 13.63 11.089 24.72 24.719 24.72s24.719-11.09 24.719-24.72S41.63 3.985 28 3.985 3.281 15.073 3.281 28.703M19.688 45.11c0-.906.734-1.641 1.64-1.641h13.344a1.64 1.64 0 0 1 0 3.281H21.328a1.64 1.64 0 0 1-1.64-1.64M28 40.188c.42 0 .84-.16 1.16-.48l3.281-3.282a1.64 1.64 0 0 0 .45-1.48l-3.282-16.515a1.64 1.64 0 0 0-3.218 0L23.11 34.945a1.64 1.64 0 0 0 .449 1.48l3.281 3.281c.32.32.74.48 1.16.48m0-13.019 1.501 7.557-1.501 1.5-1.501-1.5zM6.563 28.704C6.563 16.488 16.408 7.266 28 7.266c12.342 0 21.438 9.973 21.438 21.437 0 5.69-2.221 11.043-6.254 15.075-.64.641-1.68.641-2.32 0l-2.321-2.32a1.64 1.64 0 1 1 2.32-2.321l1.11 1.11a17.9 17.9 0 0 0 4.11-9.903l-1.567-.001a1.64 1.64 0 1 1 0-3.28h1.565a18.36 18.36 0 0 0-4.112-10.008l-1.099 1.098a1.64 1.64 0 0 1-2.32-2.32l1.099-1.098a18.36 18.36 0 0 0-10.008-4.112v1.565a1.64 1.64 0 1 1-3.282 0v-1.565a18.36 18.36 0 0 0-10.008 4.112l1.099 1.098a1.64 1.64 0 0 1-2.32 2.32l-1.099-1.098A18.36 18.36 0 0 0 9.92 27.063h1.564a1.64 1.64 0 0 1 0 3.281H9.918a17.88 17.88 0 0 0 4.11 9.903l1.102-1.103a1.64 1.64 0 0 1 2.32 2.32l-2.314 2.315a1.64 1.64 0 0 1-2.32 0c-4.033-4.033-6.254-9.387-6.254-15.076","clip-rule":"evenodd"},null,-1),Z=[O];function G(u,e){return o(),m("svg",J,[...Z])}const K={render:G},Y={props:{account:String,lastReading:Number,lastReadingDate:String},directives:{maska:P},components:{BaseButton:B,BaseInput:I,AttachmentIcon:K,BaseInputWithTooltip:k,QuestionIcon:H},data(){return{facility:{},data:{},balance:0,readings:"",unmaskedValue:"",step:"readings",errorMsg:"",userProfile:{},userAccount:"",loading:!1,reading:"",readingDate:"",formErrors:{userAccount:"",readings:""}}},computed:{filteredFacilities(){var u,e;return((e=(u=this.userProfile)==null?void 0:u.facilities)==null?void 0:e.filter(t=>t.account))||[]}},methods:{...g(V,["open","close"]),...g(R,["fetchUserProfile"]),...g(M,["setPaymentInfo"]),changeData(u){var e,t,l;this.userAccount=u.account,this.reading=((t=(e=this.userProfile)==null?void 0:e.facilities[u.index].reading)==null?void 0:t.toString())??"",this.readingDate=((l=this.userProfile)==null?void 0:l.facilities[u.index].readingDate)??""},formatDate:u=>u?new Date(u).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}):"",clearError(u){this.formErrors[u]=""},limitInput(u,e){this[u].toString().length>e&&(this[u]=this[u].toString().slice(0,e))},validateFields(){let u=!0;return this.account||(this.userAccount?this.formErrors.userAccount="":(this.formErrors.userAccount="Лицевой счет не может быть пустым",u=!1)),!this.readings||isNaN(Number(this.readings))?(this.formErrors.readings="Текущие показания должны быть числом",u=!1):Number(this.readings)<=0?(this.formErrors.readings="Текущие показания должны быть больше нуля",u=!1):this.formErrors.readings="",u},closeModal(){var u;this.data&&this.setPaymentInfo(parseInt(this.userAccount),this.data.payAmount),this.userProfile&&((u=this.userProfile.facilities)!=null&&u.find(e=>e.account===this.userAccount))||this.account?this.$router.push({name:"PaymentPage",query:{account:this.userAccount?this.userAccount:this.account}}):this.$router.push({name:"PaymentPage"}),this.close()},async sendReadings(){if(this.validateFields()){this.loading=!0;try{await this.$axiosApi.post("/facility/readings",{account:this.account?this.account:this.userAccount,reading:parseInt(this.readings)}).then(({data:u})=>{u&&(this.data=u,this.step="success")})}catch(u){if(console.log(u),u.response){const{status:e,data:t}=u.response;e===409?(console.log("Показание не может быть меньше показания за прошлый месяц"),this.open(_,{message:t.message,hasRecalcBtn:!0})):this.open(_,{message:t.message})}else console.error("Ошибка без ответа сервера:",u),this.open(_,{message:"Произошла ошибка. Пожалуйста, попробуйте позже."})}this.loading=!1}}},async beforeMount(){var e;if(this.account){this.userAccount=this.account;return}const u=localStorage.getItem("user");if(u&&(this.userProfile=JSON.parse(u),(e=this.userProfile)!=null&&e.facilities.length)){const t=this.userProfile.facilities.find(l=>l.account);t&&(this.userAccount=t.account,this.reading=t.reading.toString(),this.readingDate=t.readingDate)}}},j="/gaz-web/assets/instruction2-w7qf1uF4.jpg",r=u=>(W("data-v-3bfad2a7"),u=u(),q(),u),$={class:"attachment-wrapper"},uu={key:0,class:"readings-header"},eu=r(()=>n("div",{class:"readings-title"},"Отправить показания",-1)),tu={key:1,class:"readings"},su={class:"readings-form"},nu=r(()=>n("img",{src:L,alt:"instruction"},null,-1)),iu={class:"error-attach"},ou=r(()=>n("img",{src:j,alt:"instruction"},null,-1)),ru={class:"error-attach"},au={key:2},cu={class:"success"},lu=r(()=>n("h3",{class:"success-title"},"Ваши показания газа приняты!",-1)),du={class:"consumption"},hu=r(()=>n("span",{class:"name"},"Потребление:",-1)),mu=r(()=>n("sup",null,"3",-1)),gu={class:"total"},fu=r(()=>n("span",{class:"name"},"Сумма к оплате:",-1)),pu={class:"tariff"},_u=r(()=>n("span",{class:"name"},"Тариф:",-1));function Eu(u,e,t,l,s,i){var F,y,C;const w=X("AttachmentIcon"),x=Q,E=k,S=I,b=z,A=B,D=T("maska");return o(),m("div",$,[s.step==="readings"?(o(),m("div",uu,[f(w),eu])):c("",!0),s.step==="readings"?(o(),m("div",tu,[n("div",su,[i.filteredFacilities.length>0&&!t.account?(o(),d(x,{key:0,items:i.filteredFacilities,showIcon:!1,onChangeFacility:i.changeData,style:{"align-self":"normal !important",width:"100%"}},null,8,["items","onChangeFacility"])):c("",!0),(!i.filteredFacilities.length||!s.userProfile)&&!t.account?v((o(),d(E,{key:1,modelValue:s.userAccount,"onUpdate:modelValue":e[0]||(e[0]=a=>s.userAccount=a),label:"Лицевой счет",placeholder:"XXXXXXXXX",inputType:"text",tooltip:!0,tooltipText:"Введите лицевой счет - указан в квитанции на оплату, например: <b style='color: #FC4E3C;'>010002733</b> (должен состоять из 9 цифр).",hasError:!!s.formErrors.userAccount,onClearError:e[1]||(e[1]=a=>i.clearError("userAccount")),onInput:e[2]||(e[2]=a=>i.limitInput("userAccount",9))},{"image-content":p(()=>[nu]),_:1},8,["modelValue","hasError"])),[[D,"#########","unmaskedValue",{unmasked:!0}]]):c("",!0),n("span",iu,h(s.formErrors.userAccount),1),s.userProfile&&i.filteredFacilities.length||t.lastReading?(o(),d(S,{key:2,placeholder:t.lastReading?t.lastReading.toString():s.reading,isDisabled:!0,date:t.lastReadingDate?i.formatDate(t.lastReadingDate):i.formatDate(s.readingDate),label:"Последние показания"},null,8,["placeholder","date"])):c("",!0),v((o(),d(E,{modelValue:s.readings,"onUpdate:modelValue":e[3]||(e[3]=a=>s.readings=a),label:"Текущие показания",placeholder:"Текущие показания",inputType:"text",tooltip:!0,tooltipText:"Введите текущее показание счётчика, например: <b style=' color: #FC4E3C;'>5460</b>. Передать нужно только черные цифры.",hasError:!!s.formErrors.readings,onClearError:e[4]||(e[4]=a=>i.clearError("readings")),onInput:e[5]||(e[5]=a=>i.limitInput("readings",7))},{"image-content":p(()=>[ou]),_:1},8,["modelValue","hasError"])),[[D,"#########","unmaskedValue",{unmasked:!0}]]),n("span",ru,h(s.formErrors.readings),1),f(A,{onClick:i.sendReadings,text:s.loading?"":"Отправить показания",withoutIcon:!0,bgColor:"#1852E0",style:{"margin-top":"30px !important","align-self":"stretch"}},{btnContent:p(()=>[s.loading?(o(),d(b,{key:0,loaderWidth:"10px",color:"white",style:{width:"15px !important"}})):c("",!0)]),_:1},8,["onClick","text"])])])):s.step==="success"?(o(),m("div",au,[n("div",cu,[lu,n("div",null,[n("div",du,[hu,n("span",null,[U(h((F=s.data)==null?void 0:F.consumption)+" м",1),mu])]),n("div",gu,[fu,n("span",null,h((y=s.data)==null?void 0:y.payAmount)+" сом",1)]),n("div",pu,[_u,n("span",null,h((C=s.data)==null?void 0:C.tariff),1)])]),f(A,{onClick:i.closeModal,text:"Оплатить",withoutIcon:!0,bgColor:"#1852E0",style:{"align-self":"stretch"}},null,8,["onClick"])])])):c("",!0)])}const Iu=N(Y,[["render",Eu],["__scopeId","data-v-3bfad2a7"]]);export{Iu as default};
