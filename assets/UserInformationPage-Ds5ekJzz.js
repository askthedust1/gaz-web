import{S as k,W as J,k as h,l as B,R as g,_ as I,o as t,c as r,b as o,t as a,h as i,T as R,d as n,w as E,i as D,X,x as C,p as b,e as v,m as W,r as y,C as Y,Y as j,v as q}from"./index-By43cUFe.js";import G from"./UploadPhotoModal-B8DhCqmP.js";import{P as H,I as K}from"./image-user-Cpis5qr6.js";import{E as Q}from"./edit-ClMIBUk-.js";import{_ as N}from"./BaseInput-DZFgZkw4.js";import Z from"./ErrorModal-D8z2UzVK.js";const $={components:{BaseLoader:k},name:"SettingsModal",directives:{maska:J},data(){return{activeSessions:[],userProfile:{},fullnameData:{inn:"",surname:"",name:"",lastName:"",passportIssuedBy:"",passportIssuedDate:"",passportNumber:""},fullnameError:{inn:"",surname:"",name:"",lastName:""},globalError:"",loading:!1}},computed:{},methods:{...h(B,["close"]),...h(g,["fetchUserProfile"]),validateFullname(){let e=!0;return this.fullnameError.surname="",this.fullnameError.name="",this.fullnameError.lastName="",this.fullnameError.inn="",this.fullnameData.inn||(this.fullnameError.inn="ИНН не может быть пустым",e=!1),this.fullnameData.surname.trim()?/^\d+$/.test(this.fullnameData.surname.trim())&&(this.fullnameError.surname="Фамилия не может быть числом",e=!1):(this.fullnameError.surname="Фамилия не может быть пустой",e=!1),this.fullnameData.name.trim()?/^\d+$/.test(this.fullnameData.name.trim())&&(this.fullnameError.name="Имя не может быть числом",e=!1):(this.fullnameError.name="Имя не может быть пустым",e=!1),e},async changeFullname(){if(this.validateFullname()){try{this.loading=!0,await this.$axiosApi.put("gazprom-app/client",this.fullnameData).then(({data:e})=>{e&&(this.close(),this.$router.push("/profile"))}).catch(e=>{this.globalError=e.response.data.message||"Ошибка при изменении паспортных данных"})}catch(e){e.response&&e.response.data&&(this.globalError=e.response.data.message||{})}this.loading=!1}},filterNumericInput(e,s){e==="inn"&&(this.fullnameData.inn=this.fullnameData.inn.replace(/\D/g,"").slice(0,s))}},beforeMount(){var s,d;const e=localStorage.getItem("user");e&&(this.userProfile=JSON.parse(e),this.userProfile&&this.userProfile.client&&(this.fullnameData.name=(s=this.userProfile.client)==null?void 0:s.name,this.fullnameData.surname=(d=this.userProfile.client)==null?void 0:d.surname,this.fullnameData.lastName=this.userProfile.client.lastName,this.fullnameData.inn=this.userProfile.client.inn,this.fullnameData.passportNumber=this.userProfile.client.passportNumber,this.fullnameData.passportIssuedDate=this.userProfile.client.passportIssuedDate,this.fullnameData.passportIssuedBy=this.userProfile.client.passportIssuedBy))}},z=e=>(b("data-v-60f0bc78"),e=e(),v(),e),ee={class:"settings-modal"},ue={сlass:"wrapper"},se=z(()=>o("p",{class:"settings-main-title"},"Редактировать личные данные",-1)),le={key:0,class:"error-pass"},te={key:0,class:"error-pass"},oe={key:1,class:"error-pass"},re={key:2,class:"error-pass"},ae={key:3,class:"error-pass"},ne={class:"date-picker"},ie=z(()=>o("div",{class:"input-label"},"Дата выдачи",-1));function me(e,s,d,V,u,m){const p=N,_=X,f=k,c=C;return t(),r("div",ee,[o("div",ue,[se,u.globalError?(t(),r("span",le,a(u.globalError),1)):i("",!0),o("form",{class:"change-pin-form",onSubmit:s[8]||(s[8]=R((...l)=>m.changeFullname&&m.changeFullname(...l),["prevent"]))},[n(p,{placeholder:"ИНН",label:"ИНН",inputType:"text",onInput:s[0]||(s[0]=l=>m.filterNumericInput("inn",14)),error:!!u.fullnameError.inn,modelValue:u.fullnameData.inn,"onUpdate:modelValue":s[1]||(s[1]=l=>u.fullnameData.inn=l)},null,8,["error","modelValue"]),u.fullnameError.inn?(t(),r("span",te,a(u.fullnameError.inn),1)):i("",!0),n(p,{placeholder:"Фамилия",label:"Фамилия",inputType:"text",error:!!u.fullnameError.surname,modelValue:u.fullnameData.surname,"onUpdate:modelValue":s[2]||(s[2]=l=>u.fullnameData.surname=l)},null,8,["error","modelValue"]),u.fullnameError.surname?(t(),r("span",oe,a(u.fullnameError.surname),1)):i("",!0),n(p,{placeholder:"Имя",label:"Имя",inputType:"text",modelValue:u.fullnameData.name,"onUpdate:modelValue":s[3]||(s[3]=l=>u.fullnameData.name=l),error:!!u.fullnameError.name},null,8,["modelValue","error"]),u.fullnameError.name?(t(),r("span",re,a(u.fullnameError.name),1)):i("",!0),n(p,{placeholder:"Отчество",label:"Отчество",inputType:"text",modelValue:u.fullnameData.lastName,"onUpdate:modelValue":s[4]||(s[4]=l=>u.fullnameData.lastName=l),error:!!u.fullnameError.lastName},null,8,["modelValue","error"]),u.fullnameError.lastName?(t(),r("span",ae,a(u.fullnameError.lastName),1)):i("",!0),n(p,{modelValue:u.fullnameData.passportNumber,"onUpdate:modelValue":s[5]||(s[5]=l=>u.fullnameData.passportNumber=l),placeholder:"Номер паспорта",label:"Номер паспорта",inputType:"text"},null,8,["modelValue"]),o("div",ne,[ie,n(_,{modelValue:u.fullnameData.passportIssuedDate,"onUpdate:modelValue":s[6]||(s[6]=l=>u.fullnameData.passportIssuedDate=l),placeholder:"Дата выдачи",style:{display:"block","margin-top":"5px"}},null,8,["modelValue"])]),n(p,{placeholder:"Кем выдан",label:"Кем выдан",inputType:"text",modelValue:u.fullnameData.passportIssuedBy,"onUpdate:modelValue":s[7]||(s[7]=l=>u.fullnameData.passportIssuedBy=l)},null,8,["modelValue"]),n(c,{text:u.loading?"":"Редактировать",withoutIcon:!0,bgColor:"#1852E0",style:{"align-self":"stretch","margin-top":"20px"}},{btnContent:E(()=>[u.loading?(t(),D(f,{key:0,loaderWidth:"10px",color:"white"})):i("",!0)]),_:1},8,["text"])],32)])])}const pe=I($,[["render",me],["__scopeId","data-v-60f0bc78"]]),ce={components:{BaseButton:C,BaseInput:N},data(){return{email:"",loading:!1,userProfile:{},errorMsg:"",globalErr:""}},computed:{...W(g,["userProfile","token"])},methods:{...h(B,["close","open"]),...h(g,["fetchUserProfile"]),async sendEmail(){if(!this.validate()){this.loading=!0;try{const{data:e}=await this.$axiosApi.post("/gazprom-app/user/email",{email:this.email},{headers:{"auth-token":this.token}});e&&(this.close(),await this.fetchUserProfile(this.$axiosApi))}catch(e){console.error(e),this.open(Z,{message:"Произошла ошибка"})}finally{this.loading=!1}}},validate(){var d;const e=((d=this.email)==null?void 0:d.toString().trim())||"";return e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?this.errorMsg="":this.errorMsg="Введите корректный email":this.errorMsg="Email не может быть пустым",this.errorMsg},clearError(){this.errorMsg=""}},mounted(){const e=localStorage.getItem("user");e&&(this.userProfile=JSON.parse(e),this.userProfile&&(this.email=this.userProfile.email))}},de=e=>(b("data-v-1c0d90ce"),e=e(),v(),e),fe={class:"add-email-modal"},he=de(()=>o("h3",{class:"main-title"},"Привязать или редактировать email",-1)),_e={key:0,class:"error-msg"},Ee={key:1,class:"error-msg"};function ge(e,s,d,V,u,m){const p=N,_=k,f=C;return t(),r("div",fe,[o("form",{onSubmit:s[1]||(s[1]=R((...c)=>m.sendEmail&&m.sendEmail(...c),["prevent"])),class:"form"},[he,u.globalErr?(t(),r("span",_e,a(u.globalErr),1)):i("",!0),n(p,{modelValue:u.email,"onUpdate:modelValue":s[0]||(s[0]=c=>u.email=c),onInput:m.clearError,error:!!u.errorMsg,placeholder:"Email",label:"Введите Email"},null,8,["modelValue","onInput","error"]),u.errorMsg?(t(),r("span",Ee,a(u.errorMsg),1)):i("",!0),n(f,{text:u.loading?"":"Отправить",withoutIcon:!0,bgColor:"#1852E0",style:{"margin-top":"40px !important","align-self":"stretch"}},{btnContent:E(()=>[u.loading?(t(),D(_,{key:0,loaderWidth:"10px",color:"white"})):i("",!0)]),_:1},8,["text"])],32)])}const De=I(ce,[["render",ge],["__scopeId","data-v-1c0d90ce"]]),Pe={components:{PlusIcon:H,EditIcon:Q,Icon:K},computed:{...W(g,["userProfile","image"])},methods:{...h(B,["open"]),...h(g,["fetchPhoto","loadUserProfileFromLocalStorage"]),handleOnClickOpenPhotoUpload(){this.open(G)},handleOnClickEditName(){this.open(pe)},handleOnClickEmail(){this.open(De)}},mounted(){var e;this.loadUserProfileFromLocalStorage(),(e=this.userProfile)!=null&&e.imageFileName&&this.fetchPhoto(this.$axiosApi)}},P=e=>(b("data-v-b56601f5"),e=e(),v(),e),ye={key:0,class:"container"},ke={class:"user-profile"},Be={class:"user-name"},Ie={key:0,class:"add-img"},Ce={key:1,class:"add-img"},be=["src"],ve={class:"user-info"},Ne=P(()=>o("h4",{class:"user-title"},"Данные идентификации:",-1)),Ve={class:"identification-info"},Fe={key:0},Se={key:1},Ue={key:2},Ae={key:3},Me={class:"identification-info"},we=P(()=>o("span",null,"Идентификация отсутствует",-1)),Oe=P(()=>o("div",{class:"default-data"},"Данные идентификации по умолчанию ипользуются при оформлении заявок",-1)),xe=P(()=>o("h4",{class:"user-title"},"Электронный адрес:",-1)),Te={class:"identification-info"},Le={key:0},Re={key:1};function We(e,s,d,V,u,m){const p=y("Icon"),_=y("PlusIcon"),f=y("EditIcon"),c=q;return e.userProfile?(t(),r("div",ye,[o("div",ke,[o("div",Be,[o("div",{class:"user-img",onClick:s[0]||(s[0]=(...l)=>m.handleOnClickOpenPhotoUpload&&m.handleOnClickOpenPhotoUpload(...l))},[n(p,{class:"edit",style:{cursor:"pointer"}}),e.userProfile.imageFileName?(t(),r("div",Ce,[o("img",{src:e.image,alt:"User Photo",class:"user-photo"},null,8,be)])):(t(),r("div",Ie,[n(_)]))]),o("div",ve,[Y(o("span",{class:"tel"},"Телефон: "+a(e.userProfile.contactNumber),513),[[j,e.userProfile.contactNumber]])])]),Ne,e.userProfile.client?(t(),D(c,{key:0},{"card-content":E(()=>{var l,F,S,U,A,M,w,O,x,T,L;return[o("div",Ve,[o("span",null,"ФИО: "+a((l=e.userProfile.client)==null?void 0:l.surname)+" "+a((F=e.userProfile.client)==null?void 0:F.name)+" "+a((S=e.userProfile.client)==null?void 0:S.lastName),1),n(f,{onClick:m.handleOnClickEditName,style:{cursor:"pointer"}},null,8,["onClick"])]),(U=e.userProfile.client)!=null&&U.inn?(t(),r("span",Fe,"ИНН: "+a((A=e.userProfile.client)==null?void 0:A.inn),1)):i("",!0),(M=e.userProfile.client)!=null&&M.passportNumber?(t(),r("span",Se,"Номер: "+a((w=e.userProfile.client)==null?void 0:w.passportNumber),1)):i("",!0),(O=e.userProfile.client)!=null&&O.passportIssuedDate?(t(),r("span",Ue,"Дата выдачи: "+a((x=e.userProfile.client)==null?void 0:x.passportIssuedDate),1)):i("",!0),(T=e.userProfile.client)!=null&&T.passportIssuedBy?(t(),r("span",Ae,"Кем выдан: "+a((L=e.userProfile.client)==null?void 0:L.passportIssuedBy),1)):i("",!0)]}),_:1})):(t(),D(c,{key:1},{"card-content":E(()=>[o("div",Me,[we,n(f,{onClick:s[1]||(s[1]=l=>e.$router.push("/profile/identification")),style:{cursor:"pointer"}})])]),_:1})),Oe,xe,n(c,null,{"card-content":E(()=>[o("div",Te,[e.userProfile.email?(t(),r("span",Le,a(e.userProfile.email),1)):(t(),r("span",Re,"Отсутствует")),n(f,{onClick:m.handleOnClickEmail,style:{cursor:"pointer"}},null,8,["onClick"])])]),_:1})])])):i("",!0)}const Ge=I(Pe,[["render",We],["__scopeId","data-v-b56601f5"]]);export{Ge as default};
