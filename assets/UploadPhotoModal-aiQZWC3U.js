import{x as _,S as v,m as k,R as d,k as g,l as b,_ as y,o as s,c as r,b as a,t as C,h as u,z as U,d as B,w as m,i as c,T as f}from"./index-GCi4HQpn.js";const E={name:"UploadPhoto",components:{BaseButton:_,BaseLoader:v},data(){return{file:[],loading:!1,errorMsg:"",loadingDelete:!1,previewUrl:""}},computed:{...k(d,["image","token"])},methods:{...g(b,["close"]),...g(d,["fetchUserProfile","updatePhoto","fetchPhoto"]),async handlePhotoUpload(){if(this.file.length===0){this.errorMsg="Вы не выбрали фото";return}try{this.loading=!0;const e=new FormData;e.append("image",this.file[0]);const{data:o}=await this.$axiosApi.post("gazprom-app/user/photo",e,{headers:{"Content-Type":"multipart/form-data","auth-token":this.token,"api-token":"WEB483122E4389443a9bae7f7546Dcdc438"}});if(o){const l=o.imageFileName;this.updatePhoto(l),this.close(),await this.fetchUserProfile(this.$axiosApi),this.$route.path!=="/profile"&&await this.fetchPhoto(this.$axiosApi)}}catch(e){console.log(e),this.errorMsg=e.response.data.message||"Ошибка при загрузке фотографии.",this.loading=!1}this.loading=!1},async deletePhotoHandler(){try{this.loadingDelete=!0;const{data:e}=await this.$axiosApi.delete("gazprom-app/user/photo");if(e){const o=d();o.image=void 0,o.imageName=void 0,this.close(),await this.fetchUserProfile(this.$axiosApi)}}catch(e){console.log(e),this.errorMsg=e.response.data.message||"Ошибка при удалении фотографии."}finally{this.loadingDelete=!1}},validateFile(e){var l;const o=e.target;if(((l=o.files)==null?void 0:l.length)===1){this.file=[o.files[0]];const n=new FileReader;n.onload=t=>{var i;this.previewUrl=(i=t.target)==null?void 0:i.result},n.readAsDataURL(this.file[0])}else this.file=[],this.previewUrl="",this.errorMsg="Вы можете загрузить только одно изображение"},clearError(){this.errorMsg=""}}},F={class:"upload-modal"},x={class:"form"},D={class:"modal-header"},P={key:0,class:"title"},M={key:1,class:"title"},A={class:"modal-body"},S={key:0,class:"error-msg"},N={class:"custom-file-input"},z={key:1,class:"image-preview"},I=["src"],L={class:"modal-footer"};function R(e,o,l,n,t,i){const h=v,p=_;return s(),r("div",F,[a("form",x,[a("div",D,[e.image?(s(),r("div",M,"Заменить фото профиля")):(s(),r("div",P,"Загрузите фото профиля"))]),a("div",A,[t.errorMsg?(s(),r("span",S,C(t.errorMsg),1)):u("",!0),a("div",N,[a("input",{type:"file",id:"fileUpload",onChange:o[0]||(o[0]=(...w)=>i.validateFile&&i.validateFile(...w)),accept:"image/jpeg,image/png"},null,32),a("label",{for:"fileUpload",class:U(["fileUpload",{error:t.errorMsg}])},"Выберите файл",2)]),t.previewUrl?(s(),r("div",z,[a("img",{src:t.previewUrl,alt:"Превью изображения"},null,8,I)])):u("",!0)]),a("div",L,[B(p,{onClick:f(i.handlePhotoUpload,["prevent"]),"disabled-btn":t.loading,text:t.loading?"":"Загрузить",withoutIcon:!0,bgColor:"#1852E0",class:"btn-primary"},{btnContent:m(()=>[t.loading?(s(),c(h,{key:0,loaderWidth:"10px",color:"white"})):u("",!0)]),_:1},8,["onClick","disabled-btn","text"]),e.image?(s(),c(p,{key:0,onClick:f(i.deletePhotoHandler,["prevent"]),"disabled-btn":t.loadingDelete,text:t.loadingDelete?"":"Удалить фото",withoutIcon:!0,bgColor:"#FF5A5F",class:"btn-secondary"},{btnContent:m(()=>[t.loadingDelete?(s(),c(h,{key:0,loaderWidth:"10px",color:"white"})):u("",!0)]),_:1},8,["onClick","disabled-btn","text"])):u("",!0)])])])}const W=y(E,[["render",R],["__scopeId","data-v-aa196d1d"]]);export{W as default};
