import{_ as f}from"./OTPInputs-CXxMFKzg.js";import{a6 as C,W as b,m as M,R as x,k as w,l as A,_ as I,r as k,Z as S,o,c as i,i as l,h as c,b as u,t as r,C as D,d as a,w as g,f as V,x as F,p as N,e as q,S as O}from"./index-CkxUTfic.js";import{A as T}from"./left-arrow-back-Byi-bALH.js";import{S as W}from"./success-N5q6QwDn.js";const K={components:{Arrow:T,BaseAuthInput:C,OTPInputs:f,SuccessIcon:W},directives:{maska:b},props:{sum:{type:Number,required:!0},account:{type:String,required:!0}},data(){return{phone:"+996 ",step:"checkPhone",data:{},otp:"",unmaskedValue:"",errorMsg:"",loading:!1,quid:""}},computed:{...M(x,["userProfile"]),formattedPhone(){return"996"+this.unmaskedValue},isBackVisible(){return this.step==="confirmPhone"||this.step==="sendSMS"}},methods:{...w(A,["close"]),handleBackClick(){this.step=this.step==="confirmPhone"?"checkPhone":""},validatePhone(){const e=/^\+996\s\(\d{3}\)-\d{3}-\d{3}$/;return!this.phone||!e.test(this.phone)?(this.errorMsg="Введите корректный номер телефона.",!1):(this.errorMsg="",!0)},async checkPhone(){if(this.validatePhone()){this.loading=!0;try{const{data:e}=await this.$axiosApi.post("/mbank/check",{phone:this.formattedPhone});e&&(this.step="confirmPhone",this.data=e,this.errorMsg="")}catch(e){console.error(e),this.errorMsg=e.response.data.message}this.loading=!1}},async sendOTP(){this.loading=!0;try{const{data:e}=await this.$axiosApi.post("/mbank/create",{phone:this.formattedPhone,amount:this.sum,account:this.account});e.success===!0?(this.quid=e.quid,this.step="otp",this.errorMsg=""):this.errorMsg=e.message}catch(e){console.error(e),this.errorMsg=e.response.data.message}this.loading=!1},async handleOtp(e){this.verifyCode(e).then(t=>{if(t)this.step="success";else return}).catch(t=>{console.error("Ошибка при проверке кода:",t)})},async verifyCode(e){try{const t=await this.$axiosApi.post("/mbank/confirm",{quid:this.quid,otp:e});return t.data.success===!0?!0:(this.errorMsg=t.data.message,!1)}catch(t){return console.log(t),!1}},closeModal(){this.close(),this.$router.push("/")}},mounted(){this.userProfile&&this.userProfile.contactNumber&&(this.phone=this.userProfile.contactNumber)}},h=e=>(N("data-v-351a1275"),e=e(),q(),e),U={class:"wrap"},L={key:0,class:"check-phone"},R=h(()=>u("span",{class:"main-text"},"Введите номер мобильного кошелька MBANK",-1)),Z={class:"error-msg"},j={key:1,class:"check-phone"},z=h(()=>u("span",{class:"main-text"},"Подтвердите номер мобильного кошелька MBANK",-1)),G={class:"information"},H={class:"error-msg"},J={class:"comment"},Q={key:2,class:"check-phone"},X=h(()=>u("span",{class:"main-text"},"Введите код подтверждения",-1)),Y={class:"subtitle"},$={key:1,class:"error-msg"},ee={key:3,class:"check-phone"},se=h(()=>u("div",{class:"success-title"},"Операция оплаты завершена успешно!",-1));function ue(e,t,m,te,s,n){const p=k("Arrow"),B=C,_=O,d=F,y=f,E=k("SuccessIcon"),v=S("maska");return o(),i("div",U,[s.step==="checkPhone"?(o(),i("div",L,[n.isBackVisible?(o(),l(p,{key:0,onClick:n.handleBackClick,class:"arrow-back"},null,8,["onClick"])):c("",!0),R,u("span",Z,r(s.errorMsg),1),D(a(B,{ref:"phoneInput",error:!!s.errorMsg,appendIcon:"@/assets/images/phone.svg",modelValue:s.phone,"onUpdate:modelValue":t[0]||(t[0]=P=>s.phone=P),placeholder:"Введите телефон",label:"Телефон",style:{"align-self":"stretch"}},null,8,["error","modelValue"]),[[v,"+996 (###)-###-###","unmaskedValue",{unmasked:!0}]]),a(d,{onClick:n.checkPhone,text:s.loading?"":"Далее",withoutIcon:!0,bgColor:"#1852E0",style:{"margin-top":"30px !important","align-self":"stretch"}},{btnContent:g(()=>[s.loading?(o(),l(_,{key:0,loaderWidth:"10px",color:"white"})):c("",!0)]),_:1},8,["onClick","text"])])):s.step==="confirmPhone"?(o(),i("div",j,[n.isBackVisible?(o(),l(p,{key:0,onClick:n.handleBackClick,class:"arrow-back"},null,8,["onClick"])):c("",!0),z,u("div",G,[u("span",H,r(s.errorMsg),1),u("div",J,r(s.data.comment),1),u("div",null,r(s.phone)+" "+r(s.data.displayName),1),u("div",null,"ЛС:"+r(m.account),1),u("div",null,[V("Сумма к оплате: "),u("b",null,r(m.sum)+" сом",1)])]),a(d,{onClick:n.sendOTP,text:s.loading?"":"Оплатить",withoutIcon:!0,bgColor:"#1852E0",style:{"margin-top":"30px !important","align-self":"stretch"}},{btnContent:g(()=>[s.loading?(o(),l(_,{key:0,loaderWidth:"10px",color:"white"})):c("",!0)]),_:1},8,["onClick","text"])])):s.step==="otp"?(o(),i("div",Q,[n.isBackVisible?(o(),l(p,{key:0,onClick:n.handleBackClick,class:"arrow-back"},null,8,["onClick"])):c("",!0),X,u("div",Y,"Отправили на "+r(s.phone),1),a(y,{error:!!s.errorMsg,numDigits:4,onComplete:n.handleOtp},null,8,["error","onComplete"]),s.errorMsg?(o(),i("span",$,r(s.errorMsg),1)):c("",!0)])):s.step==="success"?(o(),i("div",ee,[a(E),se,a(d,{onClick:n.closeModal,text:"Закрыть",withoutIcon:!0,bgColor:"#1852E0",style:{"margin-top":"30px !important","align-self":"stretch"}},null,8,["onClick"])])):c("",!0)])}const ie=I(K,[["render",ue],["__scopeId","data-v-351a1275"]]);export{ie as default};
